<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Arcane Codex - Multiplayer Lobby</title>

    <!-- Core Styles -->
    <link rel="stylesheet" href="css/design-system.css">
    <link rel="stylesheet" href="css/arcane_effects.css">
    <link rel="stylesheet" href="css/ux_enhancements.css">
    <link rel="stylesheet" href="css/multiplayer.css">

    <!-- Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <!-- Mystical Background -->
    <div class="arcane-background"></div>
    <div class="arcane-particles" id="particles"></div>

    <!-- Connection Status Overlay -->
    <div id="connectionOverlay" class="connection-overlay" style="display: none;">
        <div class="connection-modal">
            <div class="connection-spinner"></div>
            <h3 class="connection-title">Reconnecting to the Arcane Network</h3>
            <p class="connection-status">Attempt <span id="reconnectAttempt">1</span> of 5</p>
            <div class="connection-bar">
                <div class="connection-progress"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="lobby-container">

        <!-- Header with Logo and Connection Status -->
        <header class="lobby-header">
            <div class="header-left">
                <h1 class="game-logo glitch-text" data-text="THE ARCANE CODEX">
                    <span class="logo-main">THE ARCANE CODEX</span>
                    <span class="logo-subtitle">MULTIPLAYER ARENA</span>
                </h1>
            </div>
            <div class="header-right">
                <div class="connection-indicator" id="connectionStatus">
                    <span class="status-dot online"></span>
                    <span class="status-text">CONNECTED</span>
                </div>
                <button class="btn-icon btn-settings" id="btnSettings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6m0 6v6m4.22-13.22l-3.54 3.54m-1.34 1.34l-3.54 3.54M20 12h-6m-6 0H2m17.07 4.22l-3.54-3.54m-1.34-1.34l-3.54-3.54"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Lobby Content Area -->
        <main class="lobby-content">

            <!-- Left Panel: Party Management -->
            <section class="panel-left">

                <!-- Party Creation/Join -->
                <div class="party-control card-mystical" id="partyControl">
                    <h2 class="panel-title">
                        <span class="title-icon">‚öî</span>
                        FORGE YOUR PARTY
                    </h2>

                    <!-- Create Party Form -->
                    <div class="form-section" id="createPartySection">
                        <h3 class="form-subtitle">CREATE NEW PARTY</h3>
                        <div class="form-group">
                            <input type="text"
                                   class="input-mystical"
                                   id="partyNameInput"
                                   placeholder="Enter party name..."
                                   maxlength="30"
                                   autocomplete="off">
                            <label class="input-label">PARTY NAME</label>
                        </div>
                        <div class="form-group">
                            <select class="select-mystical" id="maxPlayersSelect">
                                <option value="2">2 Heroes</option>
                                <option value="3">3 Heroes</option>
                                <option value="4" selected>4 Heroes</option>
                                <option value="5">5 Heroes</option>
                                <option value="6">6 Heroes</option>
                            </select>
                            <label class="input-label">MAX PLAYERS</label>
                        </div>
                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="publicPartyCheck" class="checkbox-mystical">
                            <label for="publicPartyCheck" class="checkbox-label">
                                <span class="checkbox-box"></span>
                                Make party public
                            </label>
                        </div>
                        <button class="btn-primary btn-glow" id="btnCreateParty">
                            <span class="btn-icon">‚ú¶</span>
                            CREATE PARTY
                        </button>
                    </div>

                    <div class="divider-mystical">OR</div>

                    <!-- Join Party Form -->
                    <div class="form-section" id="joinPartySection">
                        <h3 class="form-subtitle">JOIN EXISTING PARTY</h3>
                        <div class="form-group">
                            <input type="text"
                                   class="input-mystical input-code"
                                   id="partyCodeInput"
                                   placeholder="XXXX-XXXX"
                                   maxlength="9"
                                   autocomplete="off">
                            <label class="input-label">PARTY CODE</label>
                        </div>
                        <button class="btn-secondary btn-glow" id="btnJoinParty">
                            <span class="btn-icon">‚ö°</span>
                            JOIN PARTY
                        </button>
                    </div>

                    <!-- Quick Join Public -->
                    <div class="form-section">
                        <button class="btn-tertiary btn-pulse" id="btnBrowsePublic">
                            <span class="btn-icon">üåç</span>
                            BROWSE PUBLIC PARTIES
                        </button>
                    </div>
                </div>

                <!-- Active Party Display -->
                <div class="party-info card-mystical" id="partyInfo" style="display: none;">
                    <h2 class="panel-title">
                        <span class="title-icon">‚öî</span>
                        <span id="partyDisplayName">PARTY NAME</span>
                    </h2>

                    <!-- Party Code Display -->
                    <div class="party-code-section">
                        <div class="party-code-display" id="partyCodeDisplay">
                            <span class="code-text" id="partyCode">ABCD-1234</span>
                            <button class="btn-copy" id="btnCopyCode" title="Copy party code">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="code-hint">Share this code with your allies</p>
                    </div>

                    <!-- Party Controls -->
                    <div class="party-controls">
                        <button class="btn-action btn-ready" id="btnReady">
                            <span class="ready-icon">‚öî</span>
                            <span class="ready-text">READY FOR BATTLE</span>
                        </button>
                        <button class="btn-danger btn-leave" id="btnLeaveParty">
                            <span class="btn-icon">‚ö†</span>
                            LEAVE PARTY
                        </button>
                    </div>
                </div>

                <!-- Game Phase Indicator -->
                <div class="phase-indicator card-mystical" id="phaseIndicator" style="display: none;">
                    <h3 class="phase-title">CURRENT PHASE</h3>
                    <div class="phase-display">
                        <div class="phase-icon" id="phaseIcon">üé≠</div>
                        <div class="phase-name" id="phaseName">LOBBY</div>
                        <div class="phase-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="phaseProgress"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

            <!-- Center Panel: Player List -->
            <section class="panel-center">
                <div class="player-list card-mystical" id="playerListContainer">
                    <h2 class="panel-title">
                        <span class="title-icon">üë•</span>
                        PARTY MEMBERS
                        <span class="player-count">(<span id="playerCount">0</span>/<span id="maxPlayers">6</span>)</span>
                    </h2>

                    <div class="players-grid" id="playersList">
                        <!-- Player cards will be dynamically inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div class="empty-state" id="emptyState">
                        <div class="empty-icon">‚öî</div>
                        <p class="empty-text">Waiting for brave heroes to join...</p>
                    </div>
                </div>

                <!-- Role Selection -->
                <div class="role-selector card-mystical" id="roleSelector" style="display: none;">
                    <h3 class="panel-subtitle">SELECT YOUR ROLE</h3>
                    <div class="roles-grid">
                        <button class="role-card" data-role="tank">
                            <div class="role-icon">üõ°</div>
                            <div class="role-name">TANK</div>
                            <div class="role-desc">High defense, protects allies</div>
                        </button>
                        <button class="role-card" data-role="dps">
                            <div class="role-icon">‚öî</div>
                            <div class="role-name">DPS</div>
                            <div class="role-desc">Maximum damage output</div>
                        </button>
                        <button class="role-card" data-role="healer">
                            <div class="role-icon">üíö</div>
                            <div class="role-name">HEALER</div>
                            <div class="role-desc">Keeps party alive</div>
                        </button>
                        <button class="role-card" data-role="support">
                            <div class="role-icon">‚ú®</div>
                            <div class="role-name">SUPPORT</div>
                            <div class="role-desc">Buffs and utility</div>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Right Panel: Chat -->
            <section class="panel-right">
                <div class="chat-container card-mystical">
                    <h2 class="panel-title">
                        <span class="title-icon">üí¨</span>
                        PARTY CHAT
                        <button class="btn-icon btn-minimize" id="btnMinimizeChat">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M18 15l-6-6-6 6"/>
                            </svg>
                        </button>
                    </h2>

                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be dynamically inserted here -->
                        <div class="message system-message">
                            <span class="message-icon">‚ö°</span>
                            <span class="message-text">Welcome to The Arcane Codex multiplayer lobby!</span>
                        </div>
                    </div>

                    <div class="chat-input-container">
                        <input type="text"
                               class="chat-input"
                               id="chatInput"
                               placeholder="Type your message..."
                               maxlength="200"
                               autocomplete="off">
                        <button class="btn-send" id="btnSendChat">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="22" y1="2" x2="11" y2="13"></line>
                                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                            </svg>
                        </button>
                    </div>
                </div>
            </section>

        </main>

        <!-- Public Parties Browser Modal -->
        <div class="modal-overlay" id="publicPartiesModal" style="display: none;">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2 class="modal-title">
                        <span class="title-icon">üåç</span>
                        PUBLIC PARTIES
                    </h2>
                    <button class="btn-close" id="btnClosePublic">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="parties-list" id="publicPartiesList">
                        <!-- Public parties will be listed here -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="js/multiplayer_client.js"></script>
    <script src="js/multiplayer_ui.js"></script>
    <script src="js/particles.js"></script>
</body>
</html>