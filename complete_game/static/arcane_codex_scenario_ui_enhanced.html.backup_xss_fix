<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Arcane Codex - Enhanced Scenario Interface</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;900&family=Yrsa:wght@300;400;500;600;700&display=swap');

        :root {
            /* Primary Color Palette */
            --gold-bright: #FFD700;
            --gold-medium: #D4AF37;
            --gold-dark: #B8860B;
            --bronze-light: #8B7355;
            --bronze-medium: #5C4A3A;
            --bronze-dark: #3E342A;
            
            /* Background Colors */
            --bg-dark: #0A0908;
            --bg-panel: rgba(42, 36, 30, 0.95);
            --bg-panel-secondary: rgba(26, 22, 18, 0.95);
            
            /* Accent Colors */
            --whisper-purple: #7B5A8B;
            --whisper-purple-light: #9B7AAB;
            --whisper-bg: rgba(123, 90, 139, 0.15);
            
            /* Spacing Scale */
            --space-xs: 6px;
            --space-sm: 10px;
            --space-md: 15px;
            --space-lg: 20px;
            --space-xl: 30px;
            
            /* Animation Timings */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Yrsa', serif;
            background: #000;
            color: #D4AF37;
            overflow: hidden;
            height: 100vh;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, #0A0812 0%, #1A1425 100%);
        }

        /* Top HUD Bar - KEPT FROM ORIGINAL */
        .top-hud {
            height: 80px;
            background: linear-gradient(180deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.95) 100%);
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, #5C4A3A, #8B7355, #D4AF37, #8B7355, #5C4A3A) 1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 100;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.8);
        }

        .player-status {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .portrait-frame {
            width: 64px;
            height: 64px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.2), transparent 60%),
                        linear-gradient(135deg, #8B7355 0%, #2A1810 100%);
            border: 3px solid #D4AF37;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5), 0 0 20px rgba(212, 175, 55, 0.3);
            position: relative;
        }

        .level-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 24px;
            height: 24px;
            background: #D4AF37;
            border: 2px solid #2A1810;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Cinzel', serif;
            font-size: 10px;
            font-weight: 700;
            color: #2A1810;
        }

        .player-bars {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .resource-bar {
            width: 180px;
            height: 18px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
            border: 2px solid #3E342A;
            border-radius: 9px;
            overflow: hidden;
            position: relative;
        }

        .health-fill {
            height: 100%;
            width: 85%;
            background: linear-gradient(90deg, #660000, #CC0000, #FF3333, #CC0000);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        .mana-fill {
            height: 100%;
            width: 60%;
            background: linear-gradient(90deg, #000066, #0066CC, #3399FF, #0066CC);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        .bar-text {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }

        .game-title {
            font-family: 'Cinzel', serif;
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(180deg, #FFD700, #B8860B, #FFD700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(212, 175, 55, 0.5);
            letter-spacing: 3px;
        }


        /* Game Area */
        .game-area {
            flex: 1;
            display: flex;
            position: relative;
            min-height: 0;
            overflow: hidden;
        }

        .left-panel {
            width: 60px;
            background: linear-gradient(90deg, rgba(26, 22, 18, 0.9) 0%, transparent 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            gap: 15px;
            z-index: 50;
        }

        .side-btn {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, rgba(42, 36, 30, 0.9) 0%, rgba(26, 22, 18, 0.9) 100%);
            border: 2px solid #8B7355;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 22px;
            position: relative;
        }

        .side-btn:hover {
            transform: scale(1.1);
            border-color: #D4AF37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4), inset 0 0 15px rgba(212, 175, 55, 0.2);
        }

        .tooltip {
            position: absolute;
            left: 60px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #D4AF37;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 16px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }

        .side-btn:hover .tooltip {
            opacity: 1;
        }

        /* ========================================
           SCENARIO SCENE CONTAINER
           ======================================== */
        .game-board {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 15px;
            min-height: 0;
        }

        /* Main Scenario Scene */
        .scenario-container {
            flex: 1;
            position: relative;
            background: #0A0908;
            border: 4px solid;
            border-image: linear-gradient(135deg, #5C4A3A, #8B7355, #D4AF37, #8B7355, #5C4A3A) 1;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9), inset 0 0 60px rgba(0, 0, 0, 0.8);
            overflow: hidden;
        }

        /* Right Side Panel */
        .right-panel {
            width: 320px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Panel Section Styles */
        .panel-section {
            background: linear-gradient(135deg, rgba(42, 36, 30, 0.95) 0%, rgba(26, 22, 18, 0.95) 100%);
            border: 3px solid #8B7355;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(90deg, #8B7355, #D4AF37, #8B7355);
            padding: 10px 15px;
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 700;
            color: #2A1810;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .panel-content {
            padding: 15px;
        }
n        /* Reduce padding for objectives panel */
        .panel-section:has(.objectives-list) .panel-content {
            padding: 10px;
        }

        /* Party Trust Section */
        .trust-display {
            text-align: center;
            margin-bottom: 15px;
        }

        .trust-value {
            font-family: 'Cinzel', serif;
            font-size: 32px;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }

        .trust-label {
            font-size: 18px;
            color: #8B7355;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .trust-bar {
            width: 100%;
            height: 24px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
            border: 2px solid #3E342A;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin: 15px 0;
        }

        .trust-fill {
            height: 100%;
            width: 55%;
            background: linear-gradient(90deg, #FFD700, #FFA500, #FFD700);
            box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
            transition: width 0.5s ease;
        }

        .trust-bar-text {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 700;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
        }

        .trust-tier {
            font-size: 16px;
            color: #D4AF37;
            font-style: italic;
            text-align: center;
        }

        /* Party Members */
        .party-members {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .party-member {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #8B7355;
            border-radius: 8px;
            padding: 6px;
            transition: all 0.3s ease;
        }

        .party-member:hover {
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
        }

        .member-portrait {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #8B7355 0%, #2A1810 100%);
            border: 2px solid #D4AF37;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .member-info {
            flex: 1;
        }

        .member-name {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 600;
            color: #FFD700;
        }

        .member-class {
            font-size: 18px;
            color: #8B7355;
        }

        .member-hp {
            font-size: 10px;
            color: #D4AF37;
        }

        /* Quest/Objectives Section */
        .objectives-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
            max-height: 400px;
            overflow-y: auto;
        }

        .objective-item {
            background: rgba(0, 0, 0, 0.4);
            border-left: 3px solid #D4AF37;
            padding: 5px;
            border-radius: 5px;
        }

        .objective-item.completed {
            border-left-color: #00FF00;
            opacity: 0.6;
        }

        .objective-title {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 600;
            color: #FFD700;
            margin-bottom: 5px;
        }

        .objective-desc {
            font-size: 16px;
            color: #D4AF37;
            line-height: 1.4;
        }

        .turn-counter {
            text-align: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #8B7355;
            font-family: 'Cinzel', serif;
            font-size: 16px;
            color: #D4AF37;
        }

        .scenario-scene {
            position: absolute;
            inset: 0;
        }

        /* Narrative Panel (Full Width) */
        .scene-narrative-panel {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(26, 22, 18, 0.98) 0%, rgba(42, 36, 30, 0.98) 100%);
            padding: 30px;
            overflow-y: auto;
        }

        .act-header {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            font-weight: 700;
            color: #FFD700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8B7355;
        }

        .narrative-text {
            font-size: 20px;
            line-height: 1.7;
            color: #D4AF37;
            margin-bottom: 15px;
        }

        .narrative-text em {
            color: #8B7355;
            font-style: italic;
        }

        .whisper-box {
            background: linear-gradient(135deg, rgba(139, 69, 139, 0.2), rgba(75, 0, 130, 0.2));
            border: 2px solid #8B458B;
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
        }

        .whisper-header {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Cinzel', serif;
            font-size: 18px;
            color: #DA70D6;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .whisper-header .rune-icon {
            width: 24px;
            height: 24px;
            opacity: 0.8;
            filter: drop-shadow(0 0 6px #DA70D6);
        }

        .whisper-text {
            font-size: 18px;
            line-height: 1.6;
            color: #D4AF37;
        }

        /* Choice Buttons */
        .choice-section {
            margin-top: 20px;
        }

        .choice-label {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            color: #8B7355;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .choice-btn {
            width: 100%;
            background: linear-gradient(135deg, rgba(42, 36, 30, 0.8) 0%, rgba(26, 22, 18, 0.8) 100%);
            border: 2px solid #8B7355;
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Yrsa', serif;
            font-size: 20px;
            color: #D4AF37;
            text-align: left;
        }

        .choice-btn:hover {
            border-color: #D4AF37;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(139, 115, 85, 0.3) 100%);
            transform: translateX(5px);
            box-shadow: 0 3px 15px rgba(212, 175, 55, 0.4);
        }

        /* Divine Council as Colored Narrative Text */
        .god-speech {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            border-left: 4px solid #D4AF37;
            border-radius: 6px;
            padding: 12px 15px;
            margin: 12px 0;
            background: rgba(212, 175, 55, 0.1);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .god-speech .god-icon {
            width: 48px;
            height: 48px;
            flex-shrink: 0;
            border: 2px solid var(--gold-medium);
            border-radius: 50%;
            padding: 6px;
            background: rgba(0, 0, 0, 0.6);
            filter: drop-shadow(0 0 10px rgba(212, 175, 55, 0.4));
        }

        .god-speech .god-content {
            flex: 1;
        }

        .god-speech .god-name {
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 6px;
        }

        .god-speech .god-text {
            font-size: 20px;
            line-height: 1.6;
        }

        /* VALDRIS - Order/Law (Blue, Formal Capitals) */
        .god-speech.valdris {
            border-left-color: #4169E1;
            background: rgba(65, 105, 225, 0.15);
        }
        .god-speech.valdris .god-name {
            color: #87CEEB;
        }
        .god-speech.valdris .god-text {
            color: #B0C4DE;
            font-family: 'Cinzel', serif;
            font-size: 16px;
            letter-spacing: 0.5px;
        }

        /* KAITHA - Chaos/Freedom (Orange-Red, Italic Wild) */
        .god-speech.kaitha {
            border-left-color: #FF4500;
            background: rgba(255, 69, 0, 0.15);
        }
        .god-speech.kaitha .god-name {
            color: #FF8C00;
        }
        .god-speech.kaitha .god-text {
            color: #FFA07A;
            font-style: italic;
            font-weight: 500;
        }

        /* MORVANE - Survival/Pragmatism (Grey, Bold Condensed) */
        .god-speech.morvane {
            border-left-color: #2F4F4F;
            background: rgba(47, 79, 79, 0.15);
        }
        .god-speech.morvane .god-name {
            color: #708090;
        }
        .god-speech.morvane .god-text {
            color: #A9A9A9;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        /* SYLARA - Nature/Life (Green, Flowing Serif) */
        .god-speech.sylara {
            border-left-color: #228B22;
            background: rgba(34, 139, 34, 0.15);
        }
        .god-speech.sylara .god-name {
            color: #90EE90;
        }
        .god-speech.sylara .god-text {
            color: #98FB98;
            font-family: 'Yrsa', serif;
            font-style: italic;
            font-weight: 400;
        }

        /* KORVAN - War/Courage (Crimson, Bold Aggressive) */
        .god-speech.korvan {
            border-left-color: #DC143C;
            background: rgba(220, 20, 60, 0.15);
        }
        .god-speech.korvan .god-name {
            color: #CD5C5C;
        }
        .god-speech.korvan .god-text {
            color: #F08080;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 16px;
            letter-spacing: 0.8px;
        }

        /* ATHENA - Wisdom/Knowledge (Purple, Scholarly) */
        .god-speech.athena {
            border-left-color: #9370DB;
            background: rgba(147, 112, 219, 0.15);
        }
        .god-speech.athena .god-name {
            color: #BA55D3;
        }
        .god-speech.athena .god-text {
            color: #DDA0DD;
            font-family: 'Yrsa', serif;
            font-weight: 500;
        }

        /* MERCUS - Commerce/Value (Gold, Business-like) */
        .god-speech.mercus {
            border-left-color: #FFD700;
            background: rgba(255, 215, 0, 0.15);
        }
        .god-speech.mercus .god-name {
            color: #F0E68C;
        }
        .god-speech.mercus .god-text {
            color: #EEE8AA;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        /* DRAKMOR - Power/Dominance (Dark Red, Imposing) */
        .god-speech.drakmor {
            border-left-color: #8B0000;
            background: rgba(139, 0, 0, 0.15);
        }
        .god-speech.drakmor .god-name {
            color: #DC143C;
        }
        .god-speech.drakmor .god-text {
            color: #CD5C5C;
            font-family: 'Cinzel', serif;
            font-weight: 700;
            font-size: 18px;
        }

        /* Council Judgment Summary */
        .council-judgment {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(139, 115, 85, 0.2));
            border: 2px solid #D4AF37;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .council-judgment .judgment-header {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            font-weight: 700;
            color: #FFD700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }

        .council-judgment .judgment-result {
            font-size: 16px;
            color: #D4AF37;
            line-height: 1.8;
        }

        /* Bottom Action Bar - KEPT FROM ORIGINAL */
        .bottom-hud {
            height: 100px;
            background: linear-gradient(180deg, rgba(26, 22, 18, 0.95) 0%, rgba(42, 36, 30, 0.98) 100%);
            border-top: 3px solid;
            border-image: linear-gradient(90deg, #5C4A3A, #8B7355, #D4AF37, #8B7355, #5C4A3A) 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            z-index: 100;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.8);
        }

        .action-slots {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #8B7355;
            border-radius: 10px;
        }

        .action-slot {
            width: 54px;
            height: 54px;
            background: radial-gradient(circle at center, rgba(212, 175, 55, 0.05) 0%, transparent 70%),
                        linear-gradient(135deg, #2A1810 0%, #1A0F08 100%);
            border: 2px solid #8B7355;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            font-size: 26px;
        }

        .action-slot:hover {
            transform: translateY(-3px);
            border-color: #D4AF37;
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }

        .slot-key {
            position: absolute;
            top: 2px;
            left: 4px;
            font-family: 'Cinzel', serif;
            font-size: 10px;
            font-weight: 700;
            color: #FFD700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Scrollbar */
        .scene-narrative-panel::-webkit-scrollbar {
            width: 6px;
        }

        .scene-narrative-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 3px;
        }

        .scene-narrative-panel::-webkit-scrollbar-thumb {
            background: #8B7355;
            border-radius: 3px;
        }

        .scene-narrative-panel::-webkit-scrollbar-thumb:hover {
            background: #D4AF37;
        }

        .choice-btn:active {
            transform: translateX(3px) scale(0.98);
            box-shadow: 0 1px 8px rgba(212, 175, 55, 0.6);
        }

        .action-slot:active {
            transform: scale(0.85) translateY(-3px);
        }

        .side-btn:active {
            transform: scale(0.95);
        }

        .party-member:active {
            transform: scale(0.98);
        }


        /* Tooltip for choice buttons - appears below */
        .choice-btn {
            position: relative;
        }

        .choice-btn .tooltip {
            position: absolute;
            bottom: auto;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 5px;
            z-index: 1000;
        }

        .choice-btn:hover .tooltip {
            opacity: 1;
        }

        /* Tooltip for party members - appears on right */
        .party-member {
            position: relative;
        }

        .party-member .tooltip {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            margin-left: 10px;
            z-index: 1000;
            max-width: 250px;
            white-space: normal;
        }

        .party-member:hover .tooltip {
            opacity: 1;
        }

        /* Tooltip for action slots - appears above */
        .action-slot {
            position: relative;
        }

        .action-slot .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            z-index: 1000;
        }

        .action-slot:hover .tooltip {
            opacity: 1;
        }

        /* ========================================
           OVERLAY SYSTEM STYLES
           ======================================== */

        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 200;
        }

        .game-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .overlay-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .overlay-content {
            position: relative;
            z-index: 201;
            background: linear-gradient(135deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.98) 100%);
            border: 3px solid #D4AF37;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(212, 175, 55, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .overlay-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(90deg, #8B7355, #D4AF37, #8B7355);
            padding: 20px;
            border-bottom: 2px solid #D4AF37;
            border-radius: 12px 12px 0 0;
        }

        .overlay-header h2 {
            font-family: 'Cinzel', serif;
            font-size: 28px;
            font-weight: 700;
            color: #2A1810;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 0;
        }

        .close-btn {
            background: rgba(42, 42, 42, 0.7);
            border: 2px solid #D4AF37;
            color: #D4AF37;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-family: Arial, sans-serif;
            padding: 0;
        }

        .close-btn:hover {
            background: #D4AF37;
            color: #2A1810;
            transform: scale(1.1);
        }

        .overlay-body {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }

        /* Character Info Styling */
        .character-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .char-stat {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #8B7355;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .char-stat label {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: #8B7355;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .char-stat span {
            font-size: 18px;
            color: #FFD700;
            font-weight: 600;
        }

        /* Inventory Grid Styling */
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .inventory-slot {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #8B7355;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .inventory-slot:hover {
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
            transform: translateY(-3px);
        }

        .slot-icon {
            font-size: 32px;
        }

        .slot-name {
            font-size: 14px;
            color: #D4AF37;
            font-weight: 600;
        }

        /* Skills List Styling */
        .skills-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .skill-item {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #8B7355;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .skill-item:hover {
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
        }

        .skill-name {
            font-family: 'Cinzel', serif;
            font-size: 18px;
            color: #FFD700;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .skill-level {
            font-size: 12px;
            color: #8B7355;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .skill-desc {
            font-size: 14px;
            color: #D4AF37;
            line-height: 1.5;
        }

        /* Quests List Styling */
        .quests-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .quest-item {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #8B7355;
            border-left: 4px solid #D4AF37;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .quest-item.completed {
            border-left-color: #00FF00;
            opacity: 0.7;
        }

        .quest-item:hover {
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
        }

        .quest-title {
            font-family: 'Cinzel', serif;
            font-size: 16px;
            color: #FFD700;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .quest-progress {
            font-size: 12px;
            color: #8B7355;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .quest-desc {
            font-size: 14px;
            color: #D4AF37;
            line-height: 1.5;
        }

        /* Map Container Styling */
        .map-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .map-location {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #8B7355;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .map-location:hover {
            border-color: #D4AF37;
            background: rgba(212, 175, 55, 0.1);
            transform: scale(1.05);
        }

        .map-location.active {
            border-color: #FFD700;
            background: rgba(255, 215, 0, 0.15);
        }

        .location-marker {
            font-size: 36px;
        }

        .location-name {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: #D4AF37;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Settings List Styling */
        .settings-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #8B7355;
            border-radius: 8px;
        }

        .setting-item label {
            font-family: 'Cinzel', serif;
            font-size: 14px;
            color: #D4AF37;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-item.checkbox {
            flex-direction: row;
            gap: 10px;
            cursor: pointer;
        }

        .setting-item.checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #D4AF37;
        }

        .setting-item input[type="range"] {
            flex: 1;
            cursor: pointer;
            accent-color: #D4AF37;
        }

        /* Scrollbar for Overlay Body */
        .overlay-body::-webkit-scrollbar {
            width: 8px;
        }

        .overlay-body::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
        }

        .overlay-body::-webkit-scrollbar-thumb {
            background: #8B7355;
            border-radius: 4px;
        }

        .overlay-body::-webkit-scrollbar-thumb:hover {
            background: #D4AF37;
        }

        /* ========================================
           CHARACTER SHEET OVERLAY STYLES
           ======================================== */
 section in head -->
<style>
    /* ========================================
       CHARACTER SHEET OVERLAY STYLES
       ======================================== */
    .character-sheet-content {
        max-width: 650px;
        max-height: 85vh;
    }

    .character-sheet-body {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow-y: auto;
        max-height: calc(85vh - 60px);
    }

    /* CHARACTER INFO SECTION */
    .character-info-section {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 15px;
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), transparent);
        border: 2px solid #8B7355;
        border-radius: 8px;
    }

    .character-portrait-large {
        width: 100px;
        height: 100px;
        background: radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.3), transparent 60%),
                    linear-gradient(135deg, #8B7355 0%, #2A1810 100%);
        border: 3px solid #D4AF37;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5), 0 0 25px rgba(212, 175, 55, 0.4);
        flex-shrink: 0;
    }

    .character-header {
        flex: 1;
    }

    .character-name {
        font-family: 'Cinzel', serif;
        font-size: 32px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
    }

    .character-class-title {
        font-size: 18px;
        color: #D4AF37;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 5px;
    }

    /* XP BAR */
    .xp-bar-container {
        padding: 0 5px;
    }

    .xp-bar-label {
        font-family: 'Cinzel', serif;
        font-size: 14px;
        color: #D4AF37;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
        font-weight: 600;
    }

    .xp-bar {
        width: 100%;
        height: 28px;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
        border: 2px solid #3E342A;
        border-radius: 14px;
        overflow: hidden;
        position: relative;
    }

    .xp-fill {
        height: 100%;
        background: linear-gradient(90deg, #8B7355, #D4AF37, #FFD700, #D4AF37);
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
        transition: width 0.5s ease;
    }

    .xp-text {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
    }

    /* STATS SECTION */
    .stats-section {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .stats-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 700;
        padding-bottom: 8px;
        border-bottom: 2px solid #8B7355;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
    }

    .stat-card {
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
        border: 2px solid #8B7355;
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
    }

    .stat-icon {
        font-size: 24px;
        margin-bottom: 6px;
    }

    .stat-name {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        color: #D4AF37;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 6px;
    }

    .stat-value {
        font-family: 'Cinzel', serif;
        font-size: 24px;
        font-weight: 700;
        color: #FFD700;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
    }

    /* DIVINE FAVOR SECTION */
    .divine-favor-section {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .divine-favor-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 700;
        padding-bottom: 8px;
        border-bottom: 2px solid #8B7355;
    }

    .divine-god {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(0, 0, 0, 0.3);
        padding: 8px;
        border-radius: 6px;
    }

    .divine-icon {
        width: 32px;
        height: 32px;
        border: 2px solid var(--gold-medium);
        border-radius: 50%;
        padding: 4px;
        background: rgba(0, 0, 0, 0.5);
        transition: all 0.3s ease;
    }

    .divine-icon:hover {
        transform: scale(1.1);
        border-color: var(--gold-bright);
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.6));
    }

    .divine-name {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        width: 90px;
        text-align: left;
    }

    /* God-specific colors for divine names */
    .valdris-name {
        color: #87CEEB;
    }

    .kaitha-name {
        color: #FF8C00;
    }

    .morvane-name {
        color: #708090;
    }

    .sylara-name {
        color: #90EE90;
    }

    .korvan-name {
        color: #CD5C5C;
    }

    .athena-name {
        color: #BA55D3;
    }

    .mercus-name {
        color: #F0E68C;
    }

    .divine-bar {
        flex: 1;
        height: 20px;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
        border: 1px solid #3E342A;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }

    .divine-fill {
        height: 100%;
        box-shadow: inset 0 1px 3px rgba(255, 255, 255, 0.2);
    }

    /* God-specific bar colors */
    .valdris-bar {
        background: linear-gradient(90deg, #4169E1, #87CEEB, #4169E1);
    }

    .kaitha-bar {
        background: linear-gradient(90deg, #FF4500, #FF8C00, #FF4500);
    }

    .morvane-bar {
        background: linear-gradient(90deg, #2F4F4F, #708090, #2F4F4F);
    }

    .sylara-bar {
        background: linear-gradient(90deg, #228B22, #90EE90, #228B22);
    }

    .korvan-bar {
        background: linear-gradient(90deg, #DC143C, #CD5C5C, #DC143C);
    }

    .athena-bar {
        background: linear-gradient(90deg, #9370DB, #BA55D3, #9370DB);
    }

    .mercus-bar {
        background: linear-gradient(90deg, #FFD700, #F0E68C, #FFD700);
    }

    .divine-value {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        font-weight: 700;
        color: #FFD700;
        width: 45px;
        text-align: right;
        min-width: 45px;
    }

    .divine-value.negative {
        color: #FF6B6B;
    }

    /* ABILITIES SECTION */
    .abilities-section {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .abilities-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 700;
        padding-bottom: 8px;
        border-bottom: 2px solid #8B7355;
    }

    .abilities-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .ability-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #8B7355;
        border-radius: 8px;
        padding: 12px;
        transition: all 0.3s ease;
    }

    .ability-item:hover {
        border-color: #D4AF37;
        background: rgba(212, 175, 55, 0.15);
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
    }

    .ability-icon {
        font-size: 28px;
        flex-shrink: 0;
        margin-top: 2px;
    }

    .ability-info {
        flex: 1;
    }

    .ability-name {
        font-family: 'Cinzel', serif;
        font-size: 14px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .ability-desc {
        font-size: 13px;
        color: #D4AF37;
        line-height: 1.4;
    }

    /* Scrollbar styling for character sheet */
    .character-sheet-body::-webkit-scrollbar {
        width: 6px;
    }

    .character-sheet-body::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 3px;
    }

    .character-sheet-body::-webkit-scrollbar-thumb {
        background: #8B7355;
        border-radius: 3px;
    }

    .character-sheet-body::-webkit-scrollbar-thumb:hover {
        background: #D4AF37;
    }


        /* ========================================
           INVENTORY OVERLAY STYLES
           ======================================== */

    /* ========================================
       INVENTORY OVERLAY STYLES
       ======================================== */
    #inventory-overlay {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 2000;
    }

    #inventory-overlay.active {
        display: flex;
    }

    .game-overlay {
        display: flex;
        position: fixed;
        inset: 0;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }

    .overlay-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(4px);
    }

    .overlay-panel {
        position: relative;
        z-index: 2001;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.98) 100%);
        border: 4px solid;
        border-image: linear-gradient(135deg, #5C4A3A, #8B7355, #D4AF37, #8B7355, #5C4A3A) 1;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.95), inset 0 0 30px rgba(0, 0, 0, 0.7);
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .inventory-panel {
        width: 1200px;
        max-height: 85vh;
    }

    .overlay-header {
        background: linear-gradient(90deg, #8B7355, #D4AF37, #8B7355);
        padding: 15px 25px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 3px solid #5C4A3A;
        flex-shrink: 0;
    }

    .overlay-title {
        font-family: 'Cinzel', serif;
        font-size: 28px;
        font-weight: 700;
        color: #2A1810;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .capacity-info {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #2A1810;
        font-weight: 600;
    }

    .capacity-label {
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .capacity-value {
        font-size: 18px;
        font-weight: 700;
    }

    .close-btn {
        width: 36px;
        height: 36px;
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #2A1810;
        border-radius: 50%;
        font-size: 28px;
        color: #2A1810;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
    }

    .close-btn:hover {
        background: rgba(255, 215, 0, 0.3);
        border-color: #FFD700;
        transform: rotate(90deg);
    }

    /* Inventory Filters */
    .inventory-filters {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        background: rgba(0, 0, 0, 0.3);
        border-bottom: 2px solid #8B7355;
        flex-shrink: 0;
    }

    .filter-btn {
        padding: 8px 16px;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.8) 0%, rgba(26, 22, 18, 0.8) 100%);
        border: 2px solid #8B7355;
        border-radius: 6px;
        color: #D4AF37;
        font-family: 'Cinzel', serif;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filter-btn:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(139, 115, 85, 0.3) 100%);
        color: #FFD700;
    }

    .filter-btn.active {
        border-color: #FFD700;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.4) 0%, rgba(139, 115, 85, 0.4) 100%);
        color: #FFD700;
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
    }

    /* Inventory Content */
    .inventory-content {
        display: flex;
        gap: 20px;
        padding: 20px;
        flex: 1;
        overflow-y: auto;
    }

    /* Equipment Section */
    .equipment-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
        min-width: 250px;
    }

    .equipment-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 2px;
        padding-bottom: 10px;
        border-bottom: 2px solid #8B7355;
    }

    .equipment-slots {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .equipment-slot {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: center;
    }

    .slot-label {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        color: #8B7355;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .slot-item {
        width: 100%;
        aspect-ratio: 1;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.9) 0%, rgba(26, 22, 18, 0.9) 100%);
        border: 3px solid #8B7355;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .slot-item.equipped {
        border-color: #D4AF37;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.4), inset 0 0 10px rgba(212, 175, 55, 0.1);
    }

    .slot-item:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(139, 115, 85, 0.2) 100%);
        transform: scale(1.05);
    }

    /* Grid Section */
    .grid-section {
        display: flex;
        flex-direction: column;
        gap: 12px;
        flex: 1;
        min-width: 600px;
    }

    .grid-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 2px;
        padding-bottom: 10px;
        border-bottom: 2px solid #8B7355;
    }

    .inventory-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 10px;
        flex: 1;
    }

    .inventory-slot {
        aspect-ratio: 1;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.85) 0%, rgba(26, 22, 18, 0.85) 100%);
        border: 2px solid #8B7355;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        min-height: 60px;
    }

    .inventory-slot:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(139, 115, 85, 0.2) 100%);
        transform: scale(1.08);
        box-shadow: 0 0 12px rgba(212, 175, 55, 0.3);
    }

    .grid-item {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        position: relative;
        cursor: grab;
        user-select: none;
    }

    .grid-item:active {
        cursor: grabbing;
    }

    .item-quantity {
        position: absolute;
        bottom: 2px;
        right: 4px;
        background: rgba(212, 175, 55, 0.9);
        color: #2A1810;
        font-family: 'Cinzel', serif;
        font-size: 10px;
        font-weight: 700;
        padding: 2px 4px;
        border-radius: 3px;
        min-width: 16px;
        text-align: center;
    }

    /* Item Details Panel */
    .item-details {
        background: rgba(0, 0, 0, 0.3);
        border-top: 2px solid #8B7355;
        padding: 15px 20px;
        min-height: 100px;
        flex-shrink: 0;
    }

    .details-title {
        font-family: 'Cinzel', serif;
        font-size: 14px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
    }

    .details-content {
        font-size: 14px;
        color: #D4AF37;
        line-height: 1.6;
    }

    .details-placeholder {
        color: #8B7355;
        font-style: italic;
    }

    /* Tooltip/Hover Details */
    [data-tooltip] {
        position: relative;
    }

    [data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 120%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.95);
        color: #D4AF37;
        padding: 8px 12px;
        border: 2px solid #8B7355;
        border-radius: 6px;
        font-family: 'Yrsa', serif;
        font-size: 12px;
        white-space: nowrap;
        z-index: 3000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.8);
    }

    /* Inventory Scrollbar */
    .inventory-content::-webkit-scrollbar {
        width: 8px;
    }

    .inventory-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
    }

    .inventory-content::-webkit-scrollbar-thumb {
        background: #8B7355;
        border-radius: 4px;
    }

    .inventory-content::-webkit-scrollbar-thumb:hover {
        background: #D4AF37;
    }



        /* ========================================
           CHARACTER SHEET OVERLAY STYLES - INTEGRATED
           ======================================== */
section in head -->
<style>
    /* ========================================
       CHARACTER SHEET OVERLAY STYLES
       ======================================== */
    .character-sheet-content {
        max-width: 650px;
        max-height: 85vh;
    }

    .character-sheet-body {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 20px;
        overflow-y: auto;
        max-height: calc(85vh - 60px);
    }

    /* CHARACTER INFO SECTION */
    .character-info-section {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 15px;
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.3), transparent);
        border: 2px solid #8B7355;
        border-radius: 8px;
    }

    .character-portrait-large {
        width: 100px;
        height: 100px;
        background: radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.3), transparent 60%),
                    linear-gradient(135deg, #8B7355 0%, #2A1810 100%);
        border: 3px solid #D4AF37;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5), 0 0 25px rgba(212, 175, 55, 0.4);
        flex-shrink: 0;
    }

    .character-header {
        flex: 1;
    }

    .character-name {
        font-family: 'Cinzel', serif;
        font-size: 32px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 2px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
    }

    .character-class-title {
        font-size: 18px;
        color: #D4AF37;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-top: 5px;
    }

    /* XP BAR */
    .xp-bar-container {
        padding: 0 5px;
    }

    .xp-bar-label {
        font-family: 'Cinzel', serif;
        font-size: 14px;
        color: #D4AF37;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
        font-weight: 600;
    }

    .xp-bar {
        width: 100%;
        height: 28px;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
        border: 2px solid #3E342A;
        border-radius: 14px;
        overflow: hidden;
        position: relative;
    }

    .xp-fill {
        height: 100%;
        background: linear-gradient(90deg, #8B7355, #D4AF37, #FFD700, #D4AF37);
        box-shadow: inset 0 2px 4px rgba(255, 255, 255, 0.3);
        transition: width 0.5s ease;
    }

    .xp-text {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
    }

    /* STATS SECTION */
    .stats-section {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .stats-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 700;
        padding-bottom: 8px;
        border-bottom: 2px solid #8B7355;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
    }

    .stat-card {
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.2));
        border: 2px solid #8B7355;
        border-radius: 8px;
        padding: 12px;
        text-align: center;
        transition: all 0.3s ease;
    }

    .stat-card:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
    }

    .stat-icon {
        font-size: 24px;
        margin-bottom: 6px;
    }

    .stat-name {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        color: #D4AF37;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
        margin-bottom: 6px;
    }

    .stat-value {
        font-family: 'Cinzel', serif;
        font-size: 24px;
        font-weight: 700;
        color: #FFD700;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
    }

    /* DIVINE FAVOR SECTION */
    .divine-favor-section {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .divine-favor-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 700;
        padding-bottom: 8px;
        border-bottom: 2px solid #8B7355;
    }

    .divine-god {
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(0, 0, 0, 0.3);
        padding: 8px;
        border-radius: 6px;
    }

    .divine-icon {
        width: 32px;
        height: 32px;
        border: 2px solid var(--gold-medium);
        border-radius: 50%;
        padding: 4px;
        background: rgba(0, 0, 0, 0.5);
        transition: all 0.3s ease;
    }

    .divine-icon:hover {
        transform: scale(1.1);
        border-color: var(--gold-bright);
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.6));
    }

    .divine-name {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        width: 90px;
        text-align: left;
    }

    /* God-specific colors for divine names */
    .valdris-name {
        color: #87CEEB;
    }

    .kaitha-name {
        color: #FF8C00;
    }

    .morvane-name {
        color: #708090;
    }

    .sylara-name {
        color: #90EE90;
    }

    .korvan-name {
        color: #CD5C5C;
    }

    .athena-name {
        color: #BA55D3;
    }

    .mercus-name {
        color: #F0E68C;
    }

    .divine-bar {
        flex: 1;
        height: 20px;
        background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
        border: 1px solid #3E342A;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }

    .divine-fill {
        height: 100%;
        box-shadow: inset 0 1px 3px rgba(255, 255, 255, 0.2);
    }

    /* God-specific bar colors */
    .valdris-bar {
        background: linear-gradient(90deg, #4169E1, #87CEEB, #4169E1);
    }

    .kaitha-bar {
        background: linear-gradient(90deg, #FF4500, #FF8C00, #FF4500);
    }

    .morvane-bar {
        background: linear-gradient(90deg, #2F4F4F, #708090, #2F4F4F);
    }

    .sylara-bar {
        background: linear-gradient(90deg, #228B22, #90EE90, #228B22);
    }

    .korvan-bar {
        background: linear-gradient(90deg, #DC143C, #CD5C5C, #DC143C);
    }

    .athena-bar {
        background: linear-gradient(90deg, #9370DB, #BA55D3, #9370DB);
    }

    .mercus-bar {
        background: linear-gradient(90deg, #FFD700, #F0E68C, #FFD700);
    }

    .divine-value {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        font-weight: 700;
        color: #FFD700;
        width: 45px;
        text-align: right;
        min-width: 45px;
    }

    .divine-value.negative {
        color: #FF6B6B;
    }

    /* ABILITIES SECTION */
    .abilities-section {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .abilities-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 700;
        padding-bottom: 8px;
        border-bottom: 2px solid #8B7355;
    }

    .abilities-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .ability-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #8B7355;
        border-radius: 8px;
        padding: 12px;
        transition: all 0.3s ease;
    }

    .ability-item:hover {
        border-color: #D4AF37;
        background: rgba(212, 175, 55, 0.15);
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
    }

    .ability-icon {
        font-size: 28px;
        flex-shrink: 0;
        margin-top: 2px;
    }

    .ability-info {
        flex: 1;
    }

    .ability-name {
        font-family: 'Cinzel', serif;
        font-size: 14px;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
        margin-bottom: 4px;
    }

    .ability-desc {
        font-size: 13px;
        color: #D4AF37;
        line-height: 1.4;
    }

    /* Scrollbar styling for character sheet */
    .character-sheet-body::-webkit-scrollbar {
        width: 6px;
    }

    .character-sheet-body::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 3px;
    }

    .character-sheet-body::-webkit-scrollbar-thumb {
        background: #8B7355;
        border-radius: 3px;
    }

    .character-sheet-body::-webkit-scrollbar-thumb:hover {
        background: #D4AF37;
    }

        /* ========================================
           INVENTORY OVERLAY STYLES - INTEGRATED
           ======================================== */
/* ========================================
       INVENTORY OVERLAY STYLES
       ======================================== */
    #inventory-overlay {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 2000;
    }

    #inventory-overlay.active {
        display: flex;
    }

    .game-overlay {
        display: flex;
        position: fixed;
        inset: 0;
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }

    .overlay-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(4px);
    }

    .overlay-panel {
        position: relative;
        z-index: 2001;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.98) 100%);
        border: 4px solid;
        border-image: linear-gradient(135deg, #5C4A3A, #8B7355, #D4AF37, #8B7355, #5C4A3A) 1;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.95), inset 0 0 30px rgba(0, 0, 0, 0.7);
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .inventory-panel {
        width: 1200px;
        max-height: 85vh;
    }

    .overlay-header {
        background: linear-gradient(90deg, #8B7355, #D4AF37, #8B7355);
        padding: 15px 25px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 3px solid #5C4A3A;
        flex-shrink: 0;
    }

    .overlay-title {
        font-family: 'Cinzel', serif;
        font-size: 28px;
        font-weight: 700;
        color: #2A1810;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    .capacity-info {
        display: flex;
        align-items: center;
        gap: 10px;
        font-family: 'Cinzel', serif;
        font-size: 16px;
        color: #2A1810;
        font-weight: 600;
    }

    .capacity-label {
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .capacity-value {
        font-size: 18px;
        font-weight: 700;
    }

    .close-btn {
        width: 36px;
        height: 36px;
        background: rgba(0, 0, 0, 0.3);
        border: 2px solid #2A1810;
        border-radius: 50%;
        font-size: 28px;
        color: #2A1810;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
    }

    .close-btn:hover {
        background: rgba(255, 215, 0, 0.3);
        border-color: #FFD700;
        transform: rotate(90deg);
    }

    /* Inventory Filters */
    .inventory-filters {
        display: flex;
        gap: 10px;
        padding: 15px 20px;
        background: rgba(0, 0, 0, 0.3);
        border-bottom: 2px solid #8B7355;
        flex-shrink: 0;
    }

    .filter-btn {
        padding: 8px 16px;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.8) 0%, rgba(26, 22, 18, 0.8) 100%);
        border: 2px solid #8B7355;
        border-radius: 6px;
        color: #D4AF37;
        font-family: 'Cinzel', serif;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .filter-btn:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.3) 0%, rgba(139, 115, 85, 0.3) 100%);
        color: #FFD700;
    }

    .filter-btn.active {
        border-color: #FFD700;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.4) 0%, rgba(139, 115, 85, 0.4) 100%);
        color: #FFD700;
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
    }

    /* Inventory Content */
    .inventory-content {
        display: flex;
        gap: 20px;
        padding: 20px;
        flex: 1;
        overflow-y: auto;
    }

    /* Equipment Section */
    .equipment-section {
        display: flex;
        flex-direction: column;
        gap: 15px;
        min-width: 250px;
    }

    .equipment-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 2px;
        padding-bottom: 10px;
        border-bottom: 2px solid #8B7355;
    }

    .equipment-slots {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }

    .equipment-slot {
        display: flex;
        flex-direction: column;
        gap: 6px;
        align-items: center;
    }

    .slot-label {
        font-family: 'Cinzel', serif;
        font-size: 12px;
        color: #8B7355;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
    }

    .slot-item {
        width: 100%;
        aspect-ratio: 1;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.9) 0%, rgba(26, 22, 18, 0.9) 100%);
        border: 3px solid #8B7355;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .slot-item.equipped {
        border-color: #D4AF37;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.4), inset 0 0 10px rgba(212, 175, 55, 0.1);
    }

    .slot-item:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(139, 115, 85, 0.2) 100%);
        transform: scale(1.05);
    }

    /* Grid Section */
    .grid-section {
        display: flex;
        flex-direction: column;
        gap: 12px;
        flex: 1;
        min-width: 600px;
    }

    .grid-header {
        font-family: 'Cinzel', serif;
        font-size: 16px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 2px;
        padding-bottom: 10px;
        border-bottom: 2px solid #8B7355;
    }

    .inventory-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 10px;
        flex: 1;
    }

    .inventory-slot {
        aspect-ratio: 1;
        background: linear-gradient(135deg, rgba(42, 36, 30, 0.85) 0%, rgba(26, 22, 18, 0.85) 100%);
        border: 2px solid #8B7355;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        min-height: 60px;
    }

    .inventory-slot:hover {
        border-color: #D4AF37;
        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2) 0%, rgba(139, 115, 85, 0.2) 100%);
        transform: scale(1.08);
        box-shadow: 0 0 12px rgba(212, 175, 55, 0.3);
    }

    .grid-item {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        position: relative;
        cursor: grab;
        user-select: none;
    }

    .grid-item:active {
        cursor: grabbing;
    }

    .item-quantity {
        position: absolute;
        bottom: 2px;
        right: 4px;
        background: rgba(212, 175, 55, 0.9);
        color: #2A1810;
        font-family: 'Cinzel', serif;
        font-size: 10px;
        font-weight: 700;
        padding: 2px 4px;
        border-radius: 3px;
        min-width: 16px;
        text-align: center;
    }

    /* Item Details Panel */
    .item-details {
        background: rgba(0, 0, 0, 0.3);
        border-top: 2px solid #8B7355;
        padding: 15px 20px;
        min-height: 100px;
        flex-shrink: 0;
    }

    .details-title {
        font-family: 'Cinzel', serif;
        font-size: 14px;
        font-weight: 700;
        color: #FFD700;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
    }

    .details-content {
        font-size: 14px;
        color: #D4AF37;
        line-height: 1.6;
    }

    .details-placeholder {
        color: #8B7355;
        font-style: italic;
    }

    /* Tooltip/Hover Details */
    [data-tooltip] {
        position: relative;
    }

    [data-tooltip]:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 120%;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.95);
        color: #D4AF37;
        padding: 8px 12px;
        border: 2px solid #8B7355;
        border-radius: 6px;
        font-family: 'Yrsa', serif;
        font-size: 12px;
        white-space: nowrap;
        z-index: 3000;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.8);
    }

    /* Inventory Scrollbar */
    .inventory-content::-webkit-scrollbar {
        width: 8px;
    }

    .inventory-content::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 4px;
    }

    .inventory-content::-webkit-scrollbar-thumb {
        background: #8B7355;
        border-radius: 4px;
    }

    .inventory-content::-webkit-scrollbar-thumb:hover {
        background: #D4AF37;
    }

    /* ========================================
/* ========================================
   THE ARCANE CODEX - ENHANCED OVERLAY STYLES
   Dark Fantasy UI Visual Overhaul
   ======================================== */

/* ========================================
   GLOBAL OVERLAY ENHANCEMENTS
   ======================================== */

/* Fix display states */
.overlay, .game-overlay {
    display: none !important;
    position: fixed;
    inset: 0;
    z-index: 200;
    animation: fadeIn 0.3s ease;
}

.overlay.active, .game-overlay.active {
    display: flex !important;
    align-items: center;
    justify-content: center;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        backdrop-filter: blur(0px);
    }
    to {
        opacity: 1;
        backdrop-filter: blur(8px);
    }
}

.overlay-backdrop {
    background: radial-gradient(circle at center, rgba(10, 9, 8, 0.85), rgba(0, 0, 0, 0.95));
    backdrop-filter: blur(8px);
    animation: backdropFade 0.3s ease;
}

.overlay-content, .overlay-panel, .inventory-panel {
    background:
        linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, transparent 30%),
        linear-gradient(225deg, rgba(139, 115, 85, 0.1) 0%, transparent 30%),
        linear-gradient(180deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.98) 100%);
    border: 3px solid transparent;
    border-image: linear-gradient(135deg, #3E342A, #8B7355, #D4AF37, #FFD700, #D4AF37, #8B7355, #3E342A) 1;
    box-shadow:
        0 0 80px rgba(212, 175, 55, 0.2),
        0 30px 90px rgba(0, 0, 0, 0.9),
        inset 0 0 60px rgba(0, 0, 0, 0.5),
        inset 0 0 120px rgba(212, 175, 55, 0.05);
    position: relative;
    overflow: hidden;
}

.overlay-content::before, .overlay-panel::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, transparent, #D4AF37, transparent);
    opacity: 0;
    z-index: -1;
    animation: borderGlow 3s ease-in-out infinite;
}

@keyframes borderGlow {
    0%, 100% { opacity: 0; }
    50% { opacity: 0.3; }
}

.overlay-header {
    background:
        linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent),
        linear-gradient(90deg, #3E342A, #8B7355, #D4AF37, #FFD700, #D4AF37, #8B7355, #3E342A);
    box-shadow:
        0 5px 20px rgba(0, 0, 0, 0.8),
        inset 0 1px 0 rgba(255, 215, 0, 0.3),
        inset 0 -1px 0 rgba(0, 0, 0, 0.5);
    position: relative;
    overflow: hidden;
}

.overlay-header::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    animation: headerShine 4s ease-in-out infinite;
}

@keyframes headerShine {
    0% { left: -100%; }
    50%, 100% { left: 100%; }
}

.overlay-header h2, .overlay-title {
    font-family: 'Cinzel', serif;
    font-weight: 900;
    background: linear-gradient(180deg, #FFD700, #FFA500, #FFD700);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow:
        0 0 30px rgba(255, 215, 0, 0.5),
        0 2px 4px rgba(0, 0, 0, 0.8);
    animation: titlePulse 2s ease-in-out infinite;
}

@keyframes titlePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.close-btn {
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.2), transparent),
        linear-gradient(135deg, #2A1810, #3E342A);
    border: 2px solid #8B7355;
    box-shadow:
        0 4px 10px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 215, 0, 0.2);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.close-btn:hover {
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.4), transparent),
        linear-gradient(135deg, #D4AF37, #FFD700);
    border-color: #FFD700;
    box-shadow:
        0 0 20px rgba(255, 215, 0, 0.6),
        0 6px 12px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transform: rotate(90deg) scale(1.1);
}

/* Enhanced Scrollbar */
.overlay-body::-webkit-scrollbar {
    width: 12px;
}

.overlay-body::-webkit-scrollbar-track {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(42, 36, 30, 0.4));
    border: 1px solid #3E342A;
    border-radius: 6px;
    box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.5);
}

.overlay-body::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #8B7355, #5C4A3A);
    border: 1px solid #D4AF37;
    border-radius: 6px;
    box-shadow:
        0 0 10px rgba(212, 175, 55, 0.3),
        inset 0 0 4px rgba(255, 215, 0, 0.2);
}

.overlay-body::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #D4AF37, #8B7355);
    box-shadow:
        0 0 15px rgba(255, 215, 0, 0.5),
        inset 0 0 6px rgba(255, 255, 255, 0.3);
}

/* ========================================
   CHARACTER SHEET ENHANCEMENTS
   ======================================== */

.character-sheet-content {
    max-width: 750px;
}

.character-portrait-large {
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.4), transparent 50%),
        radial-gradient(circle at 70% 70%, rgba(139, 115, 85, 0.3), transparent 50%),
        linear-gradient(135deg, #8B7355 0%, #2A1810 100%);
    border: 4px solid transparent;
    border-image: linear-gradient(45deg, #3E342A, #8B7355, #D4AF37, #FFD700) 1;
    box-shadow:
        0 0 40px rgba(212, 175, 55, 0.4),
        inset 0 0 30px rgba(0, 0, 0, 0.6),
        0 10px 30px rgba(0, 0, 0, 0.8);
    animation: portraitFloat 3s ease-in-out infinite;
}

@keyframes portraitFloat {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

.character-name {
    background: linear-gradient(90deg, #B8860B, #FFD700, #FFA500, #FFD700, #B8860B);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: nameShimmer 3s linear infinite;
    background-size: 200% auto;
}

@keyframes nameShimmer {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
}

/* Attributes Section */
.attributes-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin: 20px 0;
}

.attribute-item {
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.1), transparent),
        linear-gradient(180deg, rgba(0, 0, 0, 0.6), rgba(42, 36, 30, 0.4));
    border: 2px solid #5C4A3A;
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.attribute-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 2px;
    background: linear-gradient(90deg, transparent, #FFD700, transparent);
    animation: attributeScan 3s ease-in-out infinite;
    animation-delay: var(--delay, 0s);
}

@keyframes attributeScan {
    0% { left: -100%; }
    50%, 100% { left: 100%; }
}

.attribute-item:hover {
    border-color: #D4AF37;
    background:
        linear-gradient(135deg, rgba(255, 215, 0, 0.15), transparent),
        linear-gradient(180deg, rgba(0, 0, 0, 0.7), rgba(42, 36, 30, 0.5));
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3);
}

.attribute-value {
    font-family: 'Cinzel', serif;
    font-size: 28px;
    font-weight: 700;
    background: linear-gradient(180deg, #FFD700, #D4AF37);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
}

/* Divine Favor Section */
.divine-favor-section {
    background:
        radial-gradient(circle at center, rgba(123, 90, 139, 0.1), transparent),
        linear-gradient(135deg, rgba(0, 0, 0, 0.7), rgba(42, 36, 30, 0.5));
    border: 2px solid #7B5A8B;
    border-radius: 15px;
    padding: 20px;
    margin: 20px 0;
    position: relative;
}

.divine-favor-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.god-favor {
    background:
        radial-gradient(circle at center, rgba(255, 215, 0, 0.05), transparent),
        linear-gradient(135deg, rgba(0, 0, 0, 0.8), rgba(139, 115, 85, 0.2));
    border: 2px solid #5C4A3A;
    border-radius: 10px;
    padding: 10px;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.god-favor::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: var(--favor-height, 0%);
    background: linear-gradient(180deg, rgba(255, 215, 0, 0.3), rgba(212, 175, 55, 0.1));
    transition: height 0.5s ease;
}

.god-favor:hover {
    border-color: #D4AF37;
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
}

.god-icon {
    font-size: 28px;
    margin-bottom: 5px;
    filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
    animation: godIconPulse 2s ease-in-out infinite;
    animation-delay: calc(var(--index, 0) * 0.2s);
}

@keyframes godIconPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

/* XP Bar Enhancement */
.xp-bar-container {
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(42, 36, 30, 0.4));
    border: 2px solid #5C4A3A;
    border-radius: 15px;
    padding: 15px;
    margin: 20px 0;
}

.xp-bar {
    height: 30px;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.6));
    border: 2px solid #3E342A;
    border-radius: 15px;
    overflow: hidden;
    position: relative;
    box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8);
}

.xp-fill {
    height: 100%;
    background:
        linear-gradient(90deg, #8B7355, #D4AF37, #FFD700, #D4AF37, #8B7355);
    background-size: 200% 100%;
    animation: xpFlow 2s linear infinite;
    box-shadow:
        0 0 20px rgba(255, 215, 0, 0.6),
        inset 0 2px 4px rgba(255, 255, 255, 0.3);
    position: relative;
}

@keyframes xpFlow {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}

.xp-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 50%;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.3), transparent);
}

/* ========================================
   INVENTORY OVERLAY ENHANCEMENTS
   ======================================== */

.inventory-panel {
    width: 1200px;
    max-width: 90vw;
}

.equipment-section {
    background:
        radial-gradient(circle at top left, rgba(139, 115, 85, 0.1), transparent),
        linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(42, 36, 30, 0.3));
    border: 2px solid #5C4A3A;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
}

.equipment-header {
    font-family: 'Cinzel', serif;
    font-size: 18px;
    font-weight: 700;
    color: #FFD700;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #8B7355;
    text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
}

.equipment-slot {
    background:
        radial-gradient(circle at center, rgba(0, 0, 0, 0.8), rgba(42, 36, 30, 0.6));
    border: 3px solid #5C4A3A;
    border-radius: 12px;
    padding: 12px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.equipment-slot::before {
    content: '';
    position: absolute;
    inset: -3px;
    background: linear-gradient(45deg, transparent, #8B7355, transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.equipment-slot:hover::before {
    opacity: 1;
    animation: slotRotate 2s linear infinite;
}

@keyframes slotRotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.equipment-slot:hover {
    border-color: #D4AF37;
    transform: scale(1.02);
    box-shadow:
        0 0 30px rgba(212, 175, 55, 0.4),
        inset 0 0 15px rgba(255, 215, 0, 0.1);
}

.slot-item {
    width: 80px;
    height: 80px;
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.1), transparent),
        linear-gradient(135deg, #2A1810, #3E342A);
    border: 2px solid #8B7355;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
    transition: all 0.3s ease;
    position: relative;
    cursor: pointer;
}

.slot-item.equipped {
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.3), transparent),
        linear-gradient(135deg, #5C4A3A, #8B7355);
    border-color: #D4AF37;
    box-shadow:
        0 0 20px rgba(212, 175, 55, 0.5),
        inset 0 0 10px rgba(255, 215, 0, 0.2);
    animation: equippedPulse 2s ease-in-out infinite;
}

@keyframes equippedPulse {
    0%, 100% {
        box-shadow:
            0 0 20px rgba(212, 175, 55, 0.5),
            inset 0 0 10px rgba(255, 215, 0, 0.2);
    }
    50% {
        box-shadow:
            0 0 30px rgba(255, 215, 0, 0.7),
            inset 0 0 15px rgba(255, 215, 0, 0.3);
    }
}

/* Rarity Colors */
.slot-item.common {
    border-color: #888;
}

.slot-item.uncommon {
    border-color: #4CAF50;
    box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
}

.slot-item.rare {
    border-color: #2196F3;
    box-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
}

.slot-item.epic {
    border-color: #9C27B0;
    box-shadow: 0 0 25px rgba(156, 39, 176, 0.6);
}

.slot-item.legendary {
    border-color: #FF9800;
    box-shadow: 0 0 30px rgba(255, 152, 0, 0.7);
    animation: legendaryGlow 1.5s ease-in-out infinite;
}

@keyframes legendaryGlow {
    0%, 100% {
        box-shadow:
            0 0 30px rgba(255, 152, 0, 0.7),
            inset 0 0 20px rgba(255, 152, 0, 0.3);
    }
    50% {
        box-shadow:
            0 0 50px rgba(255, 152, 0, 1),
            inset 0 0 30px rgba(255, 152, 0, 0.5);
    }
}

/* Item Grid Enhancement */
.item-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 12px;
    padding: 15px;
    background:
        linear-gradient(135deg, rgba(0, 0, 0, 0.4), transparent),
        rgba(26, 22, 18, 0.3);
    border: 1px solid #3E342A;
    border-radius: 10px;
}

.item-slot {
    aspect-ratio: 1;
    background:
        radial-gradient(circle at center, rgba(0, 0, 0, 0.6), rgba(42, 36, 30, 0.4));
    border: 2px solid #3E342A;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
}

.item-slot::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at center, transparent, rgba(212, 175, 55, 0.2));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.item-slot:hover::before {
    opacity: 1;
}

.item-slot:hover {
    border-color: #8B7355;
    transform: scale(1.05);
    z-index: 10;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
}

.item-slot.has-item:hover {
    border-color: #D4AF37;
    box-shadow:
        0 0 20px rgba(212, 175, 55, 0.4),
        0 5px 15px rgba(0, 0, 0, 0.6);
}

/* Tooltips Enhancement */
.item-tooltip {
    position: fixed;
    z-index: 1000;
    background:
        linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(42, 36, 30, 0.95));
    border: 2px solid #D4AF37;
    border-radius: 10px;
    padding: 12px;
    min-width: 200px;
    box-shadow:
        0 0 30px rgba(212, 175, 55, 0.3),
        0 10px 30px rgba(0, 0, 0, 0.8);
    pointer-events: none;
    opacity: 0;
    transform: scale(0.9);
    transition: all 0.2s ease;
}

.item-tooltip.active {
    opacity: 1;
    transform: scale(1);
}

.tooltip-header {
    font-family: 'Cinzel', serif;
    font-size: 16px;
    font-weight: 700;
    color: #FFD700;
    margin-bottom: 8px;
    padding-bottom: 6px;
    border-bottom: 1px solid #8B7355;
}

.tooltip-stats {
    display: flex;
    flex-direction: column;
    gap: 4px;
    font-size: 14px;
    color: #D4AF37;
}

/* ========================================
   SKILLS OVERLAY ENHANCEMENTS
   ======================================== */

.skills-tree {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    padding: 20px;
}

.skill-branch {
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.05), transparent),
        linear-gradient(180deg, rgba(0, 0, 0, 0.6), rgba(42, 36, 30, 0.3));
    border: 2px solid #5C4A3A;
    border-radius: 12px;
    padding: 15px;
    position: relative;
}

.branch-header {
    font-family: 'Cinzel', serif;
    font-size: 18px;
    font-weight: 700;
    color: #FFD700;
    text-align: center;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
}

.skill-node {
    width: 80px;
    height: 80px;
    margin: 10px auto;
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.1), transparent),
        linear-gradient(135deg, #2A1810, #3E342A);
    border: 3px solid #5C4A3A;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.skill-node::before {
    content: '';
    position: absolute;
    width: 2px;
    height: 30px;
    background: linear-gradient(180deg, transparent, #8B7355, transparent);
    top: -30px;
    left: 50%;
    transform: translateX(-50%);
}

.skill-node:first-child::before {
    display: none;
}

.skill-node.unlocked {
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.3), transparent),
        linear-gradient(135deg, #5C4A3A, #8B7355);
    border-color: #D4AF37;
    box-shadow:
        0 0 25px rgba(212, 175, 55, 0.5),
        inset 0 0 15px rgba(255, 215, 0, 0.2);
}

.skill-node.active {
    animation: skillActive 1.5s ease-in-out infinite;
}

@keyframes skillActive {
    0%, 100% {
        box-shadow:
            0 0 25px rgba(212, 175, 55, 0.5),
            inset 0 0 15px rgba(255, 215, 0, 0.2);
        transform: scale(1);
    }
    50% {
        box-shadow:
            0 0 40px rgba(255, 215, 0, 0.8),
            inset 0 0 20px rgba(255, 215, 0, 0.4);
        transform: scale(1.05);
    }
}

.skill-node.locked {
    opacity: 0.5;
    filter: grayscale(50%);
}

.skill-node:hover:not(.locked) {
    transform: scale(1.1);
    border-color: #FFD700;
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
}

/* Ability Hotbar */
.ability-hotbar {
    display: flex;
    gap: 10px;
    padding: 15px;
    background:
        linear-gradient(180deg, rgba(0, 0, 0, 0.7), rgba(42, 36, 30, 0.4));
    border: 2px solid #5C4A3A;
    border-radius: 10px;
    margin-top: 20px;
}

.hotbar-slot {
    width: 60px;
    height: 60px;
    background:
        radial-gradient(circle at center, rgba(0, 0, 0, 0.7), rgba(42, 36, 30, 0.5));
    border: 2px solid #3E342A;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
}

.hotbar-slot.filled {
    border-color: #8B7355;
    background:
        radial-gradient(circle at 30% 30%, rgba(212, 175, 55, 0.2), transparent),
        linear-gradient(135deg, #3E342A, #5C4A3A);
}

.hotbar-slot:hover {
    border-color: #D4AF37;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
}

.cooldown-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #FFD700;
    font-family: 'Cinzel', serif;
    font-weight: 700;
    font-size: 18px;
}

/* ========================================
   QUESTS OVERLAY ENHANCEMENTS
   ======================================== */

.quest-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
    padding: 10px;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.5), transparent);
    border-bottom: 2px solid #5C4A3A;
}

.quest-tab {
    padding: 10px 20px;
    background:
        linear-gradient(135deg, rgba(42, 36, 30, 0.8), rgba(26, 22, 18, 0.8));
    border: 2px solid #5C4A3A;
    border-radius: 8px 8px 0 0;
    cursor: pointer;
    font-family: 'Cinzel', serif;
    font-weight: 600;
    color: #8B7355;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
}

.quest-tab.active {
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.3), rgba(212, 175, 55, 0.1));
    border-color: #D4AF37;
    color: #FFD700;
    transform: translateY(-2px);
    box-shadow: 0 -5px 15px rgba(212, 175, 55, 0.3);
}

.quest-tab:hover:not(.active) {
    border-color: #8B7355;
    color: #D4AF37;
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.1), rgba(42, 36, 30, 0.8));
}

.quest-category {
    margin-bottom: 25px;
}

.category-header {
    font-family: 'Cinzel', serif;
    font-size: 20px;
    font-weight: 700;
    color: #FFD700;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid #8B7355;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
}

.quest-card {
    background:
        linear-gradient(135deg, rgba(0, 0, 0, 0.6), rgba(42, 36, 30, 0.4));
    border: 2px solid #5C4A3A;
    border-left: 5px solid #D4AF37;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.quest-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
    transition: left 0.5s ease;
}

.quest-card:hover::before {
    left: 100%;
}

.quest-card:hover {
    border-color: #8B7355;
    transform: translateX(5px);
    box-shadow:
        -5px 0 15px rgba(212, 175, 55, 0.3),
        0 5px 20px rgba(0, 0, 0, 0.5);
}

.quest-card.completed {
    border-left-color: #4CAF50;
    opacity: 0.7;
}

.quest-objectives {
    margin: 10px 0;
    padding-left: 15px;
}

.objective-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 8px 0;
    color: #D4AF37;
    font-size: 14px;
}

.objective-checkbox {
    width: 18px;
    height: 18px;
    border: 2px solid #8B7355;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.objective-checkbox.checked {
    background: #4CAF50;
    border-color: #4CAF50;
}

.objective-checkbox.checked::after {
    content: '';
    color: white;
    font-weight: bold;
}

.quest-progress-bar {
    height: 8px;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
    border: 1px solid #3E342A;
    border-radius: 4px;
    overflow: hidden;
    margin: 10px 0;
}

.quest-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #8B7355, #D4AF37, #FFD700);
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    transition: width 0.5s ease;
}

.quest-rewards {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px solid #5C4A3A;
}

.reward-item {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 10px;
    background: rgba(212, 175, 55, 0.1);
    border: 1px solid #8B7355;
    border-radius: 5px;
    font-size: 12px;
    color: #FFD700;
}

/* ========================================
   MAP OVERLAY ENHANCEMENTS
   ======================================== */

.map-wrapper {
    position: relative;
    width: 100%;
    height: 500px;
    background:
        radial-gradient(circle at center, rgba(139, 115, 85, 0.05), transparent),
        linear-gradient(180deg, #0A0908, #1A1425);
    border: 3px solid #5C4A3A;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: inset 0 0 50px rgba(0, 0, 0, 0.8);
}

.map-canvas {
    width: 100%;
    height: 100%;
    position: relative;
}

/* Fog of War Effect */
.fog-of-war {
    position: absolute;
    inset: 0;
    background: radial-gradient(
        circle at var(--player-x, 50%) var(--player-y, 50%),
        transparent 20%,
        rgba(0, 0, 0, 0.7) 40%,
        rgba(0, 0, 0, 0.9) 60%
    );
    pointer-events: none;
    mix-blend-mode: multiply;
}

.location-marker {
    position: absolute;
    width: 40px;
    height: 40px;
    transform: translate(-50%, -50%);
    cursor: pointer;
    transition: all 0.3s ease;
}

.location-icon {
    width: 100%;
    height: 100%;
    background:
        radial-gradient(circle at center, rgba(212, 175, 55, 0.3), transparent),
        linear-gradient(135deg, #5C4A3A, #8B7355);
    border: 2px solid #D4AF37;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
    animation: markerPulse 2s ease-in-out infinite;
}

@keyframes markerPulse {
    0%, 100% {
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        transform: scale(1);
    }
    50% {
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.7);
        transform: scale(1.1);
    }
}

.location-marker:hover .location-icon {
    transform: scale(1.2);
    box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
    border-color: #FFD700;
}

.location-marker.visited .location-icon {
    opacity: 0.7;
    animation: none;
}

.location-marker.current .location-icon {
    border-color: #4CAF50;
    box-shadow: 0 0 30px rgba(76, 175, 80, 0.6);
}

.map-path {
    position: absolute;
    height: 2px;
    background: linear-gradient(90deg, transparent, #8B7355, transparent);
    transform-origin: left center;
    opacity: 0.5;
}

.map-path.traveled {
    background: linear-gradient(90deg, transparent, #D4AF37, transparent);
    opacity: 1;
}

/* Map Controls */
.map-controls {
    position: absolute;
    bottom: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.map-control-btn {
    width: 40px;
    height: 40px;
    background:
        linear-gradient(135deg, rgba(42, 36, 30, 0.9), rgba(26, 22, 18, 0.9));
    border: 2px solid #8B7355;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: #D4AF37;
    font-size: 20px;
    transition: all 0.3s ease;
}

.map-control-btn:hover {
    border-color: #D4AF37;
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.3), rgba(42, 36, 30, 0.9));
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
}

/* Map Legend */
.map-legend {
    position: absolute;
    top: 20px;
    left: 20px;
    background:
        linear-gradient(135deg, rgba(42, 36, 30, 0.95), rgba(26, 22, 18, 0.95));
    border: 2px solid #8B7355;
    border-radius: 8px;
    padding: 10px;
    min-width: 150px;
}

.legend-title {
    font-family: 'Cinzel', serif;
    font-size: 14px;
    font-weight: 700;
    color: #FFD700;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 5px 0;
    font-size: 12px;
    color: #D4AF37;
}

/* ========================================
   SETTINGS OVERLAY ENHANCEMENTS
   ======================================== */

.settings-tabs {
    display: flex;
    gap: 5px;
    margin-bottom: 20px;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.5), transparent);
    padding: 10px;
    border-bottom: 2px solid #5C4A3A;
}

.settings-tab {
    padding: 8px 16px;
    background:
        linear-gradient(135deg, rgba(42, 36, 30, 0.8), rgba(26, 22, 18, 0.8));
    border: 2px solid #5C4A3A;
    border-radius: 6px 6px 0 0;
    cursor: pointer;
    font-family: 'Cinzel', serif;
    font-weight: 600;
    color: #8B7355;
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: all 0.3s ease;
    font-size: 12px;
}

.settings-tab.active {
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.3), rgba(212, 175, 55, 0.1));
    border-color: #D4AF37;
    color: #FFD700;
    transform: translateY(-2px);
}

.settings-group {
    margin-bottom: 25px;
    padding: 15px;
    background:
        linear-gradient(135deg, rgba(0, 0, 0, 0.4), transparent),
        rgba(42, 36, 30, 0.2);
    border: 1px solid #3E342A;
    border-radius: 8px;
}

.settings-group-header {
    font-family: 'Cinzel', serif;
    font-size: 16px;
    font-weight: 700;
    color: #FFD700;
    margin-bottom: 15px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
}

.setting-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px;
    margin: 8px 0;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid #3E342A;
    border-radius: 6px;
    transition: all 0.3s ease;
}

.setting-row:hover {
    background: rgba(139, 115, 85, 0.1);
    border-color: #5C4A3A;
}

.setting-label {
    font-size: 14px;
    color: #D4AF37;
    font-weight: 500;
}

/* Custom Slider */
.custom-slider {
    width: 150px;
    height: 6px;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
    border: 1px solid #3E342A;
    border-radius: 3px;
    position: relative;
    cursor: pointer;
}

.slider-fill {
    height: 100%;
    background: linear-gradient(90deg, #8B7355, #D4AF37);
    border-radius: 2px;
    width: var(--value, 50%);
    transition: width 0.3s ease;
}

.slider-thumb {
    position: absolute;
    top: 50%;
    left: var(--value, 50%);
    transform: translate(-50%, -50%);
    width: 18px;
    height: 18px;
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.4), transparent),
        linear-gradient(135deg, #D4AF37, #8B7355);
    border: 2px solid #FFD700;
    border-radius: 50%;
    box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    cursor: grab;
    transition: all 0.3s ease;
}

.slider-thumb:hover {
    transform: translate(-50%, -50%) scale(1.2);
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
}

/* Custom Toggle */
.custom-toggle {
    width: 50px;
    height: 26px;
    background: linear-gradient(180deg, rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.6));
    border: 2px solid #3E342A;
    border-radius: 13px;
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
}

.custom-toggle.active {
    background: linear-gradient(180deg, rgba(139, 115, 85, 0.3), rgba(212, 175, 55, 0.2));
    border-color: #8B7355;
}

.toggle-slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 18px;
    height: 18px;
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.3), transparent),
        linear-gradient(135deg, #5C4A3A, #8B7355);
    border: 1px solid #D4AF37;
    border-radius: 50%;
    transition: all 0.3s ease;
    box-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
}

.custom-toggle.active .toggle-slider {
    left: calc(100% - 22px);
    background:
        radial-gradient(circle at 30% 30%, rgba(255, 215, 0, 0.5), transparent),
        linear-gradient(135deg, #D4AF37, #FFD700);
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
}

/* Dropdown Enhancement */
.custom-dropdown {
    position: relative;
    width: 150px;
}

.dropdown-selected {
    padding: 8px 12px;
    background:
        linear-gradient(135deg, rgba(42, 36, 30, 0.8), rgba(26, 22, 18, 0.8));
    border: 2px solid #5C4A3A;
    border-radius: 6px;
    cursor: pointer;
    color: #D4AF37;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
}

.dropdown-selected:hover {
    border-color: #8B7355;
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.2), rgba(42, 36, 30, 0.8));
}

.dropdown-options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background:
        linear-gradient(180deg, rgba(42, 36, 30, 0.98), rgba(26, 22, 18, 0.98));
    border: 2px solid #8B7355;
    border-radius: 6px;
    margin-top: 5px;
    overflow: hidden;
    opacity: 0;
    transform: scaleY(0);
    transform-origin: top;
    transition: all 0.3s ease;
    z-index: 100;
}

.dropdown-options.open {
    opacity: 1;
    transform: scaleY(1);
}

.dropdown-option {
    padding: 8px 12px;
    color: #D4AF37;
    cursor: pointer;
    transition: all 0.2s ease;
}

.dropdown-option:hover {
    background: rgba(212, 175, 55, 0.2);
    color: #FFD700;
    padding-left: 16px;
}

/* Button Styles */
.settings-button {
    padding: 12px 24px;
    background:
        linear-gradient(135deg, rgba(139, 115, 85, 0.3), rgba(212, 175, 55, 0.1));
    border: 2px solid #8B7355;
    border-radius: 8px;
    color: #FFD700;
    font-family: 'Cinzel', serif;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.settings-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
    transition: left 0.5s ease;
}

.settings-button:hover::before {
    left: 100%;
}

.settings-button:hover {
    border-color: #D4AF37;
    background:
        linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(255, 215, 0, 0.2));
    transform: translateY(-2px);
    box-shadow:
        0 5px 20px rgba(212, 175, 55, 0.4),
        0 10px 30px rgba(0, 0, 0, 0.6);
}

.settings-button:active {
    transform: translateY(0);
}

/* ========================================
   RESPONSIVE ADJUSTMENTS
   ======================================== */

@media (max-width: 768px) {
    .overlay-content, .overlay-panel {
        width: 95%;
        max-height: 90vh;
    }

    .inventory-panel {
        width: 95vw;
    }

    .equipment-slots {
        grid-template-columns: 1fr;
    }

    .skills-tree {
        grid-template-columns: 1fr;
    }

    .map-legend {
        display: none;
    }
}       ENHANCED OVERLAY STYLES FROM OPUS 4.1
       ======================================== */
    </style>
}</head>
<body>
    <div class="game-container">
        <!-- Game Area -->
        <div class="game-area">
            <!-- Left Side Panel -->
            <div class="left-panel">
                <div class="side-btn">
                    
                    <div class="tooltip">Character (C)</div>
                </div>
                <div class="side-btn">
                    
                    <div class="tooltip">Inventory (I)</div>
                </div>
                <div class="side-btn">
                    
                    <div class="tooltip">Skills (K)</div>
                </div>
                <div class="side-btn">
                    
                    <div class="tooltip">Quests (J)</div>
                </div>
                <div class="side-btn">
                    
                    <div class="tooltip">Map (M)</div>
                </div>
                <div class="side-btn">
                    
                    <div class="tooltip">Settings (ESC)</div>
                </div>
            </div>

            <!-- Game Board -->
            <div class="game-board">
                <!-- Main Scenario Scene -->
                <div class="scenario-container">
                    <div class="scenario-scene">
                        <!-- Narrative Panel (Full Width) -->
                        <div class="scene-narrative-panel">
                            <div class="act-header"> Act 1: The Warehouse</div>
                            <div style="text-align: center; margin-bottom: 20px;">
                                <img src="images/arcane_codex_logo.svg" alt="The Arcane Codex" style="max-width: 400px; width: 100%; height: auto;">
                            </div>

                            <div class="narrative-text">
                                Rain hammers the cobblestones as you arrive at the Duke's warehouse.
                                Grimsby whispers urgently: <em>"The medicine for my daughter is inside.
                                We need to move fast."</em>
                            </div>

                            <div class="narrative-text">
                                The guards appear distracted, their attention focused on a dice game
                                near the entrance. The warehouse door is unlocked, swinging gently
                                in the wind.
                            </div>

                            <div class="whisper-box">
                                <div class="whisper-header">
                                    <img src="images/rune_symbol_1.svg" alt="Rune" class="rune-icon">
                                     Fighter Whisper
                                </div>
                                <div class="whisper-text">
                                    Your combat training reveals this is a <strong>TRAP</strong>.
                                    The "distracted" guards are professionalstheir stance is combat-ready,
                                    swords positioned for quick draw. This feels like an ambush.
                                </div>
                            </div>

                            <div class="choice-section">
                                <div class="choice-label"> Available Actions</div>
                                <div class="choice-btn"> Enter through front door<div class="tooltip">Risky - Might trigger trap</div></div>
                                <div class="choice-btn"> Search for alternate entrance<div class="tooltip">Safer but takes time</div></div>
                                <div class="choice-btn"> Confront the guards directly<div class="tooltip">Honest approach - May start combat</div></div>
                                <div class="choice-btn"> Warn party about the trap<div class="tooltip">Share your whisper - Builds trust</div></div>
                            </div>

                            <!-- Divine Council Comments (hidden for gameplay testing) -->
                            <!-- Will be shown dynamically after player makes a choice -->
                            <!--
                            <div class="act-header" style="margin-top: 25px;"> Divine Council Convenes</div>

                            <div class="god-speech valdris">
                                <img src="images/god_valdris.svg" alt="Valdris" class="god-icon">
                                <div class="god-content">
                                    <div class="god-name"> VALDRIS SPEAKS</div>
                                    <div class="god-text">"ORDER DEMANDS ACCOUNTABILITY. This theft, however noble in intent, violates the Duke's law. I vote OPPOSE."</div>
                                </div>
                            </div>

                            <div class="god-speech kaitha">
                                <img src="images/god_kaitha.svg" alt="Kaitha" class="god-icon">
                                <div class="god-content">
                                    <div class="god-name"> KAITHA SPEAKS</div>
                                    <div class="god-text">"Break the chains of unjust law! The child's life matters more than the Duke's gold. I vote SUPPORT!"</div>
                                </div>
                            </div>

                            ... (additional god speeches will be added via JavaScript following this pattern)
                            -->
                        </div>
                    </div>
                </div>

                <!-- Right Side Panel -->
                <div class="right-panel">
                    <!-- Party & Trust Panel -->
                    <div class="panel-section">
                        <div class="panel-header"> Party</div>
                        <div class="panel-content">

                            <!-- Party Members -->
                            <div class="party-members">
                                <div class="party-member">
                                    <div class="member-portrait"></div>
                                    <div class="member-info">
                                        <div class="member-name">Lyra</div>
                                        <div class="member-class">Mage  Level 11</div>
                                        <div class="member-hp">HP: 420/600</div>
                                    </div>
                                </div>

                                <div class="party-member">
                                    <div class="member-portrait"></div>
                                    <div class="member-info">
                                        <div class="member-name">Grimsby</div>
                                        <div class="member-class">NPC Companion</div>
                                        <div class="member-hp">Approval: 45/100</div>
                                    </div>
                                </div>

                                <div class="party-member">
                                    <div class="member-portrait"></div>
                                    <div class="member-info">
                                        <div class="member-name">Renna</div>
                                        <div class="member-class">NPC Companion</div>
                                        <div class="member-hp">Approval: 60/100</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quest/Objectives Panel -->
                    <div class="panel-section" style="flex: 2;">
                        <div class="panel-header"> Objectives</div>
                        <div class="panel-content">
                            <div class="objectives-list">
                                <div class="objective-item">
                                    <div class="objective-title"> Primary: The Medicine Heist</div>
                                    <div class="objective-desc">
                                        Obtain medicine from Duke's warehouse for Grimsby's daughter
                                    </div>
                                </div>

                                <div class="objective-item">
                                    <div class="objective-title"> Optional: Investigate the Guards</div>
                                    <div class="objective-desc">
                                        Determine if the "distracted" guards are truly unaware
                                    </div>
                                </div>

                                <div class="objective-item">
                                    <div class="objective-title"> Optional: Examine the Medicine</div>
                                    <div class="objective-desc">
                                        Use arcane knowledge to check for curses or dark magic
                                    </div>
                                </div>

                                <div class="objective-item completed">
                                    <div class="objective-title"> Enter Valdria Safely</div>
                                    <div class="objective-desc">
                                        Reach the safe town hub without incident
                                    </div>
                                </div>
                            </div>

                            <div class="turn-counter">
                                Turn 3  Act 1
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <!-- Bottom Action Bar -->
        <div class="bottom-hud">
            <!-- Left Player Stats -->
            <div class="player-status">
                <div class="portrait-frame">
                    
                    <div class="level-badge">12</div>
                </div>
            </div>
                <div class="player-bars">
                    <div class="resource-bar">
                        <div class="health-fill"></div>
                        <div class="bar-text">850 / 1000</div>
                    </div>
                    <div class="resource-bar">
                        <div class="mana-fill"></div>
                        <div class="bar-text">420 / 700</div>
                    </div>
                </div>

            <div class="action-slots">
                <div class="action-slot">
                    <span class="slot-key">1</span>
                    
                    <div class="tooltip">Melee Attack (Hotkey: 1)</div>
                </div>
                <div class="action-slot">
                    <span class="slot-key">2</span>
                    
                    <div class="tooltip">Defensive Stance (Hotkey: 2)</div>
                </div>
                <div class="action-slot">
                    <span class="slot-key">3</span>
                    
                    <div class="tooltip">Fireball Spell (Hotkey: 3)</div>
                </div>
                <div class="action-slot">
                    <span class="slot-key">4</span>
                    
                    <div class="tooltip">Lightning Bolt (Hotkey: 4)</div>
                </div>
                <div class="action-slot">
                    <span class="slot-key">5</span>
                    
                    <div class="tooltip">Health Potion (Hotkey: 5)</div>
                </div>
                <div class="action-slot">
                    <span class="slot-key">6</span>
                    
                    <div class="tooltip">Mana Potion (Hotkey: 6)</div>
                </div>
                <div class="action-slot">
                    <span class="slot-key">7</span>
                    
                    <div class="tooltip">Scroll of Teleport (Hotkey: 7)</div>
                </div>
                <div class="action-slot">
                    <span class="slot-key">8</span>
                    
                    <div class="tooltip">Precision Shot (Hotkey: 8)</div>
                </div>
            </div>

        </div>
        <!-- Overlay Elements - All 6 Integrated Overlays -->

        <!-- 1. Character Sheet Overlay -->
        <div id="character-overlay" class="overlay character-sheet-overlay">
    <div class="overlay-backdrop"></div>
    <div class="overlay-content character-sheet-content">
        <div class="overlay-header">
            <h2> Character Sheet</h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="overlay-body character-sheet-body">
            <!-- CHARACTER INFO SECTION -->
            <div class="character-info-section">
                <div class="character-portrait-large">
                    
                </div>
                <div class="character-header">
                    <div class="character-name">Aldric</div>
                    <div class="character-class-title">Fighter  Level 12</div>
                </div>
            </div>

            <!-- XP BAR -->
            <div class="xp-bar-container">
                <div class="xp-bar-label">Experience</div>
                <div class="xp-bar">
                    <div class="xp-fill" style="width: 65%;"></div>
                    <div class="xp-text">6,500 / 10,000 (65%)</div>
                </div>
            </div>

            <!-- STATS SECTION -->
            <div class="stats-section">
                <div class="stats-header">Attributes</div>
                <div class="stats-grid">
                    <!-- Row 1: Strength, Dexterity, Constitution -->
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-name">Strength</div>
                        <div class="stat-value">18</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-name">Dexterity</div>
                        <div class="stat-value">14</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-name">Constitution</div>
                        <div class="stat-value">16</div>
                    </div>

                    <!-- Row 2: Intelligence, Wisdom, Charisma -->
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-name">Intelligence</div>
                        <div class="stat-value">10</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-name">Wisdom</div>
                        <div class="stat-value">12</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"></div>
                        <div class="stat-name">Charisma</div>
                        <div class="stat-value">13</div>
                    </div>
                </div>
            </div>

            <!-- DIVINE FAVOR SECTION -->
            <div class="divine-favor-section">
                <div class="divine-favor-header">Divine Favor</div>

                <!-- VALDRIS - Order/Law (Blue) -->
                <div class="divine-god">
                    <img src="images/god_valdris.svg" alt="Valdris" class="divine-icon" title="Valdris - Order/Law">
                    <div class="divine-name valdris-name">VALDRIS</div>
                    <div class="divine-bar">
                        <div class="divine-fill valdris-bar" style="width: 60%;"></div>
                        <div class="divine-value">+15</div>
                    </div>
                </div>

                <!-- KAITHA - Chaos/Freedom (Orange-Red) -->
                <div class="divine-god">
                    <img src="images/god_kaitha.svg" alt="Kaitha" class="divine-icon" title="Kaitha - Chaos/Freedom">
                    <div class="divine-name kaitha-name">KAITHA</div>
                    <div class="divine-bar">
                        <div class="divine-fill kaitha-bar" style="width: 40%;"></div>
                        <div class="divine-value negative">-10</div>
                    </div>
                </div>

                <!-- MORVANE - Survival/Pragmatism (Grey) -->
                <div class="divine-god">
                    <img src="images/god_morvane.svg" alt="Morvane" class="divine-icon" title="Morvane - Survival/Pragmatism">
                    <div class="divine-name morvane-name">MORVANE</div>
                    <div class="divine-bar">
                        <div class="divine-fill morvane-bar" style="width: 80%;"></div>
                        <div class="divine-value">+20</div>
                    </div>
                </div>

                <!-- SYLARA - Nature/Life (Green) -->
                <div class="divine-god">
                    <img src="images/god_sylara.svg" alt="Sylara" class="divine-icon" title="Sylara - Nature/Life">
                    <div class="divine-name sylara-name">SYLARA</div>
                    <div class="divine-bar">
                        <div class="divine-fill sylara-bar" style="width: 50%;"></div>
                        <div class="divine-value">+5</div>
                    </div>
                </div>

                <!-- KORVAN - War/Courage (Crimson) -->
                <div class="divine-god">
                    <img src="images/god_korvan.svg" alt="Korvan" class="divine-icon" title="Korvan - War/Courage">
                    <div class="divine-name korvan-name">KORVAN</div>
                    <div class="divine-bar">
                        <div class="divine-fill korvan-bar" style="width: 100%;"></div>
                        <div class="divine-value">+25</div>
                    </div>
                </div>

                <!-- ATHENA - Wisdom/Knowledge (Purple) -->
                <div class="divine-god">
                    <img src="images/god_athena.svg" alt="Athena" class="divine-icon" title="Athena - Wisdom/Knowledge">
                    <div class="divine-name athena-name">ATHENA</div>
                    <div class="divine-bar">
                        <div class="divine-fill athena-bar" style="width: 67%;"></div>
                        <div class="divine-value">+10</div>
                    </div>
                </div>

                <!-- MERCUS - Commerce/Value (Gold) -->
                <div class="divine-god">
                    <img src="images/god_mercus.svg" alt="Mercus" class="divine-icon" title="Mercus - Commerce/Value">
                    <div class="divine-name mercus-name">MERCUS</div>
                    <div class="divine-bar">
                        <div class="divine-fill mercus-bar" style="width: 33%;"></div>
                        <div class="divine-value negative">-5</div>
                    </div>
                </div>
            </div>

            <!-- ABILITIES SECTION -->
            <div class="abilities-section">
                <div class="abilities-header">Passive Abilities</div>
                <div class="abilities-list">
                    <div class="ability-item">
                        <div class="ability-icon"></div>
                        <div class="ability-info">
                            <div class="ability-name">Iron Skin</div>
                            <div class="ability-desc">Reduce all incoming damage by 10%</div>
                        </div>
                    </div>
                    <div class="ability-item">
                        <div class="ability-icon"></div>
                        <div class="ability-info">
                            <div class="ability-name">Veteran's Resolve</div>
                            <div class="ability-desc">Gain +2 to all saves after each combat encounter</div>
                        </div>
                    </div>
                    <div class="ability-item">
                        <div class="ability-icon"></div>
                        <div class="ability-info">
                            <div class="ability-name">Weapon Mastery</div>
                            <div class="ability-desc">Increase damage with melee weapons by 15%</div>
                        </div>
                    </div>
                    <div class="ability-item">
                        <div class="ability-icon"></div>
                        <div class="ability-info">
                            <div class="ability-name">Fortified Mind</div>
                            <div class="ability-desc">Immunity to fear and charm effects</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

        <!-- 2. Inventory Overlay -->
        <div id="inventory-overlay" class="game-overlay">
    <div class="overlay-backdrop"></div>
    <div class="overlay-panel inventory-panel">
        <div class="overlay-header">
            <div class="overlay-title">Inventory</div>
            <div class="capacity-info">
                <span class="capacity-label">Weight:</span>
                <span class="capacity-value">45 / 100</span>
            </div>
            <button class="close-btn">x</button>
        </div>

        <!-- Filters -->
        <div class="inventory-filters">
            <button class="filter-btn active" data-filter="all">All Items</button>
            <button class="filter-btn" data-filter="weapons">Weapons</button>
            <button class="filter-btn" data-filter="armor">Armor</button>
            <button class="filter-btn" data-filter="consumables">Consumables</button>
        </div>

        <div class="inventory-content">
            <!-- Equipment Slots Section -->
            <div class="equipment-section">
                <div class="equipment-header">EQUIPPED ITEMS</div>
                <div class="equipment-slots">
                    <!-- Main Hand Slot -->
                    <div class="equipment-slot main-hand" data-slot="main-hand">
                        <div class="slot-label">Main Hand</div>
                        <div class="slot-item equipped" data-item-id="weapon-001" data-tooltip="Blade of the Fallen King | Damage: 15-22 | Rare">
                            x
                        </div>
                    </div>

                    <!-- Off Hand Slot -->
                    <div class="equipment-slot off-hand" data-slot="off-hand">
                        <div class="slot-label">Off-Hand</div>
                        <div class="slot-item equipped" data-item-id="shield-001" data-tooltip="Iron Kite Shield | Defense: 8 | Common">
                            x
                        </div>
                    </div>

                    <!-- Armor Slot -->
                    <div class="equipment-slot armor" data-slot="armor">
                        <div class="slot-label">Armor</div>
                        <div class="slot-item equipped" data-item-id="armor-001" data-tooltip="Plate Armor | Defense: 12 | Uncommon">
                            x
                        </div>
                    </div>

                    <!-- Helmet Slot -->
                    <div class="equipment-slot helmet" data-slot="helmet">
                        <div class="slot-label">Helmet</div>
                        <div class="slot-item equipped" data-item-id="helmet-001" data-tooltip="Ornate Helm | Defense: 5 | Uncommon">
                            x
                        </div>
                    </div>

                    <!-- Gloves Slot -->
                    <div class="equipment-slot gloves" data-slot="gloves">
                        <div class="slot-label">Gloves</div>
                        <div class="slot-item" data-slot-empty="true">
                            -
                        </div>
                    </div>

                    <!-- Boots Slot -->
                    <div class="equipment-slot boots" data-slot="boots">
                        <div class="slot-label">Boots</div>
                        <div class="slot-item" data-slot-empty="true">
                            -
                        </div>
                    </div>

                    <!-- Accessory Slot 1 -->
                    <div class="equipment-slot accessory-1" data-slot="accessory-1">
                        <div class="slot-label">Amulet</div>
                        <div class="slot-item equipped" data-item-id="amulet-001" data-tooltip="Amulet of Warding | Magic Defense: 4 | Uncommon">
                            x
                        </div>
                    </div>

                    <!-- Accessory Slot 2 -->
                    <div class="equipment-slot accessory-2" data-slot="accessory-2">
                        <div class="slot-label">Ring</div>
                        <div class="slot-item" data-slot-empty="true">
                            -
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Grid Section -->
            <div class="grid-section">
                <div class="grid-header">INVENTORY GRID (8x6)</div>
                <div class="inventory-grid">
                    <!-- Row 1 -->
                    <div class="inventory-slot" data-slot-id="slot-0">
                        <div class="grid-item" data-item-id="potion-001" data-tooltip="Health Potion | Restores 100 HP | Common">
                            x
                            <span class="item-quantity">3</span>
                        </div>
                    </div>
                    <div class="inventory-slot" data-slot-id="slot-1">
                        <div class="grid-item" data-item-id="potion-002" data-tooltip="Mana Potion | Restores 80 Mana | Common">
                            x
                            <span class="item-quantity">2</span>
                        </div>
                    </div>
                    <div class="inventory-slot" data-slot-id="slot-2">
                        <div class="grid-item" data-item-id="key-001" data-tooltip="Copper Key | Unlocks warehouse door | Quest Item">
                            x
                            <span class="item-quantity">1</span>
                        </div>
                    </div>
                    <div class="inventory-slot" data-slot-id="slot-3">
                        <div class="grid-item" data-item-id="scroll-001" data-tooltip="Scroll of Fireball | Spell Scroll | Uncommon">
                            x
                            <span class="item-quantity">1</span>
                        </div>
                    </div>
                    <div class="inventory-slot" data-slot-id="slot-4">
                        <div class="grid-item" data-item-id="vial-001" data-tooltip="Alchemical Vial | Restores 50 HP | Rare">
                            x
                            <span class="item-quantity">5</span>
                        </div>
                    </div>
                    <div class="inventory-slot" data-slot-id="slot-5"></div>
                    <div class="inventory-slot" data-slot-id="slot-6"></div>
                    <div class="inventory-slot" data-slot-id="slot-7"></div>

                    <!-- Row 2 -->
                    <div class="inventory-slot" data-slot-id="slot-8"></div>
                    <div class="inventory-slot" data-slot-id="slot-9"></div>
                    <div class="inventory-slot" data-slot-id="slot-10"></div>
                    <div class="inventory-slot" data-slot-id="slot-11"></div>
                    <div class="inventory-slot" data-slot-id="slot-12"></div>
                    <div class="inventory-slot" data-slot-id="slot-13"></div>
                    <div class="inventory-slot" data-slot-id="slot-14"></div>
                    <div class="inventory-slot" data-slot-id="slot-15"></div>

                    <!-- Row 3 -->
                    <div class="inventory-slot" data-slot-id="slot-16"></div>
                    <div class="inventory-slot" data-slot-id="slot-17"></div>
                    <div class="inventory-slot" data-slot-id="slot-18"></div>
                    <div class="inventory-slot" data-slot-id="slot-19"></div>
                    <div class="inventory-slot" data-slot-id="slot-20"></div>
                    <div class="inventory-slot" data-slot-id="slot-21"></div>
                    <div class="inventory-slot" data-slot-id="slot-22"></div>
                    <div class="inventory-slot" data-slot-id="slot-23"></div>

                    <!-- Row 4 -->
                    <div class="inventory-slot" data-slot-id="slot-24"></div>
                    <div class="inventory-slot" data-slot-id="slot-25"></div>
                    <div class="inventory-slot" data-slot-id="slot-26"></div>
                    <div class="inventory-slot" data-slot-id="slot-27"></div>
                    <div class="inventory-slot" data-slot-id="slot-28"></div>
                    <div class="inventory-slot" data-slot-id="slot-29"></div>
                    <div class="inventory-slot" data-slot-id="slot-30"></div>
                    <div class="inventory-slot" data-slot-id="slot-31"></div>

                    <!-- Row 5 -->
                    <div class="inventory-slot" data-slot-id="slot-32"></div>
                    <div class="inventory-slot" data-slot-id="slot-33"></div>
                    <div class="inventory-slot" data-slot-id="slot-34"></div>
                    <div class="inventory-slot" data-slot-id="slot-35"></div>
                    <div class="inventory-slot" data-slot-id="slot-36"></div>
                    <div class="inventory-slot" data-slot-id="slot-37"></div>
                    <div class="inventory-slot" data-slot-id="slot-38"></div>
                    <div class="inventory-slot" data-slot-id="slot-39"></div>

                    <!-- Row 6 -->
                    <div class="inventory-slot" data-slot-id="slot-40"></div>
                    <div class="inventory-slot" data-slot-id="slot-41"></div>
                    <div class="inventory-slot" data-slot-id="slot-42"></div>
                    <div class="inventory-slot" data-slot-id="slot-43"></div>
                    <div class="inventory-slot" data-slot-id="slot-44"></div>
                    <div class="inventory-slot" data-slot-id="slot-45"></div>
                    <div class="inventory-slot" data-slot-id="slot-46"></div>
                    <div class="inventory-slot" data-slot-id="slot-47"></div>
                </div>
            </div>
        </div>

        <!-- Item Details Panel -->
        <div class="item-details">
            <div class="details-title">Item Details</div>
            <div class="details-content">
                <p class="details-placeholder">Hover over an item to view details</p>
            </div>
        </div>
    </div>
</div>

        <!-- 3. Skills Overlay -->
        <div id="skills-overlay" class="overlay">
    <div class="overlay-backdrop"></div>
    <div class="overlay-content">
        <div class="overlay-header">
            <h2> Skills & Abilities</h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="overlay-body">
            <!-- Skill Points Display -->
            <div class="skill-points-display">
                <div class="skill-points-label">Skill Points Available</div>
                <div class="skill-points-value">3</div>
            </div>

            <!-- Skills Grid -->
            <div class="skills-grid">
                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Melee Attack</div>
                    <div class="skill-level">Rank 5</div>
                    <div class="skill-hotkey">Hotkey: 1</div>
                </div>

                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Power Strike</div>
                    <div class="skill-level">Rank 3</div>
                    <div class="skill-hotkey">Hotkey: 2</div>
                </div>

                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Defensive Stance</div>
                    <div class="skill-level">Rank 4</div>
                    <div class="skill-hotkey">Hotkey: 3</div>
                </div>

                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Fireball</div>
                    <div class="skill-level">Rank 2</div>
                    <div class="skill-hotkey">Hotkey: 4</div>
                </div>

                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Lightning Bolt</div>
                    <div class="skill-level">Rank 3</div>
                    <div class="skill-hotkey">Hotkey: 5</div>
                </div>

                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Healing Potion</div>
                    <div class="skill-level">Rank 4</div>
                    <div class="skill-hotkey">Hotkey: 6</div>
                </div>

                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Arcane Mastery</div>
                    <div class="skill-level">Rank 2</div>
                    <div class="skill-hotkey">Assign: Click</div>
                </div>

                <div class="skill-card">
                    <div class="skill-icon"></div>
                    <div class="skill-name">Scroll Craft</div>
                    <div class="skill-level">Rank 1</div>
                    <div class="skill-hotkey">Assign: Click</div>
                </div>
            </div>

            <div class="skill-hint">
                 Click a skill to assign it to your hotbar, or use existing hotkeys (1-8) to execute abilities.
            </div>
        </div>
    </div>
</div>

        <!-- 4. Quests Overlay -->
        <div id="quests-overlay" class="overlay">
    <div class="overlay-backdrop"></div>
    <div class="overlay-content">
        <div class="overlay-header">
            <h2> Quest Log</h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="overlay-body">
            <!-- Quest Tabs -->
            <div class="quest-tabs">
                <div class="quest-tab active" data-tab="active">
                    <span class="tab-icon"></span>
                    <span class="tab-label">Active</span>
                    <span class="tab-count">3</span>
                </div>
                <div class="quest-tab" data-tab="completed">
                    <span class="tab-icon"></span>
                    <span class="tab-label">Completed</span>
                    <span class="tab-count">12</span>
                </div>
            </div>

            <!-- Active Quests -->
            <div class="quest-list-container" id="active-quests">
                <div class="quest-item">
                    <div class="quest-header">
                        <div class="quest-title">The Medicine Heist</div>
                        <div class="quest-giver">from Grimsby</div>
                    </div>
                    <div class="quest-description">
                        Obtain medicine from the Duke's warehouse for Grimsby's daughter who is gravely ill.
                    </div>
                    <div class="quest-objectives">
                        <div class="quest-objective">
                            <span class="objective-checkbox"></span>
                            <span class="objective-text">Locate the medicine in the warehouse</span>
                        </div>
                        <div class="quest-objective">
                            <span class="objective-checkbox"></span>
                            <span class="objective-text">Escape the warehouse without getting caught</span>
                        </div>
                        <div class="quest-objective">
                            <span class="objective-checkbox"></span>
                            <span class="objective-text">Return medicine to Grimsby</span>
                        </div>
                    </div>
                    <div class="quest-rewards">
                         Rewards: 500 XP, 100 gold, Grimsby's Approval +30
                    </div>
                </div>

                <div class="quest-item">
                    <div class="quest-header">
                        <div class="quest-title">Investigate the Guards</div>
                        <div class="quest-giver">Optional</div>
                    </div>
                    <div class="quest-description">
                        Determine if the warehouse guards are truly unaware or part of a trap.
                    </div>
                    <div class="quest-objectives">
                        <div class="quest-objective">
                            <span class="objective-checkbox"></span>
                            <span class="objective-text">Observe guard behavior</span>
                        </div>
                        <div class="quest-objective">
                            <span class="objective-checkbox"></span>
                            <span class="objective-text">Report findings to party</span>
                        </div>
                    </div>
                    <div class="quest-rewards">
                         Rewards: 200 XP, 25 gold
                    </div>
                </div>

                <div class="quest-item">
                    <div class="quest-header">
                        <div class="quest-title">Examine the Medicine</div>
                        <div class="quest-giver">Optional</div>
                    </div>
                    <div class="quest-description">
                        Use arcane knowledge to check the medicine for curses or dark magic.
                    </div>
                    <div class="quest-objectives">
                        <div class="quest-objective">
                            <span class="objective-checkbox"></span>
                            <span class="objective-text">Inspect the medicine with Arcane Mastery</span>
                        </div>
                    </div>
                    <div class="quest-rewards">
                         Rewards: 150 XP, 50 gold
                    </div>
                </div>
            </div>

            <!-- Completed Quests (Hidden by default) -->
            <div class="quest-list-container hidden" id="completed-quests">
                <div class="quest-item completed">
                    <div class="quest-header">
                        <div class="quest-title">Enter Valdria Safely</div>
                        <div class="quest-giver">Tutorial</div>
                    </div>
                    <div class="quest-description">
                        Reach the safe town hub without incident.
                    </div>
                    <div class="quest-rewards">
                         Completed - 100 XP earned
                    </div>
                </div>
                <div style="text-align: center; color: #8B7355; padding: 20px;">
                    ... and 11 more completed quests
                </div>
            </div>
        </div>
    </div>
</div>

        <!-- 5. Map Overlay - FULLY ENHANCED AND FIXED -->
<div id="map-overlay" class="overlay">
    <style>
        /* Enhanced Map Overlay Styles */
        #map-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 9999;
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(10px);
        }

        #map-overlay.active {
            display: flex !important;
            flex-direction: column;
            animation: fadeInMap 0.3s ease-in-out;
        }

        @keyframes fadeInMap {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        #map-overlay .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: linear-gradient(180deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.95) 100%);
            border-bottom: 3px solid;
            border-image: linear-gradient(90deg, #5C4A3A, #8B7355, #D4AF37, #8B7355, #5C4A3A) 1;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.8);
        }

        #map-overlay .map-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Cinzel', serif;
            font-size: 32px;
            font-weight: 700;
            color: transparent;
            background: linear-gradient(135deg, #FFD700 0%, #D4AF37 50%, #FFD700 100%);
            background-clip: text;
            -webkit-background-clip: text;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        #map-overlay .map-title .map-icon {
            font-size: 36px;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.7));
            animation: pulseGold 2s infinite;
        }

        @keyframes pulseGold {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        #map-overlay .close-btn {
            background: radial-gradient(circle, #8B7355 0%, #6B5745 100%);
            border: 2px solid #D4AF37;
            color: #FFD700;
            font-size: 28px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        #map-overlay .close-btn:hover {
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            background: radial-gradient(circle, #D4AF37 0%, #8B7355 100%);
        }

        /* Map Container */
        #map-overlay .map-container {
            flex: 1;
            position: relative;
            padding: 20px;
            overflow: hidden;
        }

        #map-overlay .world-map {
            width: 100%;
            height: 100%;
            position: relative;
            background: radial-gradient(ellipse at center, #E8D7C3 0%, #D4C4B0 40%, #C8B49C 70%, #B8A08C 100%);
            border: 6px solid;
            border-image: linear-gradient(45deg, #8B7355, #D4AF37, #FFD700, #D4AF37, #8B7355) 1;
            border-radius: 15px;
            box-shadow:
                inset 0 0 100px rgba(0, 0, 0, 0.4),
                inset 0 0 50px rgba(139, 115, 85, 0.3),
                0 15px 50px rgba(0, 0, 0, 0.9);
            overflow: hidden;
        }

        #map-overlay .world-map::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><rect width="100" height="100" fill="none" stroke="rgba(139,115,85,0.1)" stroke-width="0.5"/></svg>');
            pointer-events: none;
            opacity: 0.3;
        }

        #map-overlay #world-map-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: grab;
        }

        #map-overlay #world-map-canvas:active {
            cursor: grabbing;
        }

        /* Minimap */
        #map-overlay .minimap-container {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 280px;
            height: 220px;
            background: linear-gradient(135deg, rgba(26, 22, 18, 0.98) 0%, rgba(42, 36, 30, 0.95) 100%);
            border: 3px solid;
            border-image: linear-gradient(45deg, #8B7355, #D4AF37, #8B7355) 1;
            border-radius: 12px;
            box-shadow:
                0 0 40px rgba(0, 0, 0, 0.9),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            z-index: 300;
        }

        #map-overlay .minimap-header {
            background: linear-gradient(90deg, #8B7355 0%, #D4AF37 50%, #8B7355 100%);
            padding: 8px 15px;
            font-size: 13px;
            text-transform: uppercase;
            color: #1a1612;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-align: center;
            text-shadow: 0 1px 2px rgba(255, 215, 0, 0.5);
        }

        /* Map Controls */
        #map-overlay .map-controls {
            position: absolute;
            top: 30px;
            left: 30px;
            z-index: 200;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #map-overlay .control-group {
            background: linear-gradient(135deg, rgba(42, 36, 30, 0.95) 0%, rgba(26, 22, 18, 0.9) 100%);
            border: 2px solid #8B7355;
            border-radius: 10px;
            padding: 12px;
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 215, 0, 0.1);
        }

        #map-overlay .control-group h4 {
            color: #FFD700;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }

        #map-overlay .filter-btn {
            background: linear-gradient(135deg, rgba(139, 115, 85, 0.4) 0%, rgba(107, 87, 69, 0.2) 100%);
            border: 1px solid #8B7355;
            color: #E8D7C3;
            padding: 10px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.25s ease;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
            position: relative;
            overflow: hidden;
            width: 100%;
            font-family: 'Yrsa', serif;
            font-weight: 500;
        }

        #map-overlay .filter-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.5s ease;
        }

        #map-overlay .filter-btn:hover::before {
            left: 100%;
        }

        #map-overlay .filter-btn:hover {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.4) 0%, rgba(255, 215, 0, 0.2) 100%);
            transform: translateX(5px);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        #map-overlay .filter-btn.active {
            background: linear-gradient(135deg, #D4AF37 0%, #8B7355 100%);
            color: #1a1612;
            font-weight: 600;
            box-shadow:
                0 0 25px rgba(255, 215, 0, 0.7),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        #map-overlay .filter-btn span {
            font-size: 16px;
        }

        /* Map Legend */
        #map-overlay .map-legend {
            position: absolute;
            bottom: 30px;
            left: 30px;
            background: linear-gradient(135deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.95) 100%);
            border: 2px solid #8B7355;
            border-radius: 10px;
            padding: 18px;
            box-shadow:
                0 8px 25px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 215, 0, 0.1);
            z-index: 250;
            min-width: 200px;
        }

        #map-overlay .legend-title {
            font-size: 15px;
            color: #FFD700;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.5);
            padding-bottom: 8px;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        #map-overlay .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: #E8D7C3;
            margin-bottom: 8px;
            padding: 4px;
            transition: all 0.2s ease;
        }

        #map-overlay .legend-item:hover {
            color: #FFD700;
            transform: translateX(5px);
        }

        #map-overlay .legend-item span:first-child {
            font-size: 18px;
            filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.5));
        }

        /* Quest Indicator */
        #map-overlay .quest-indicator {
            position: absolute;
            top: 30px;
            right: 30px;
            background: linear-gradient(135deg, #8B7355 0%, #6B5745 100%);
            border: 3px solid #FFD700;
            border-radius: 10px;
            padding: 18px;
            box-shadow:
                0 0 30px rgba(255, 215, 0, 0.6),
                inset 0 0 20px rgba(0, 0, 0, 0.3);
            z-index: 250;
            max-width: 250px;
            animation: questPulse 3s infinite;
        }

        @keyframes questPulse {
            0%, 100% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), inset 0 0 20px rgba(0, 0, 0, 0.3); }
            50% { box-shadow: 0 0 50px rgba(255, 215, 0, 0.9), inset 0 0 20px rgba(0, 0, 0, 0.3); }
        }

        #map-overlay .quest-header {
            color: #FFD700;
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: 1.5px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 215, 0, 0.5);
        }

        #map-overlay .quest-content {
            color: #E8D7C3;
            font-size: 14px;
            line-height: 1.6;
        }

        #map-overlay .quest-content strong {
            color: #FFD700;
            display: block;
            margin-bottom: 5px;
            font-size: 15px;
        }

        /* Map marker styles */
        .map-marker {
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .map-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 20;
        }

        .map-marker-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(26, 22, 18, 0.95);
            border: 1px solid #D4AF37;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: nowrap;
            font-size: 12px;
            color: #FFD700;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        .map-marker:hover .map-marker-tooltip {
            opacity: 1;
        }
    </style>

    <!-- Map Header -->
    <div class="map-header">
        <div class="map-title">
            <span class="map-icon"></span>
            <span>The Realm of Arcanum</span>
        </div>
        <button class="close-btn" onclick="closeAllOverlays()"></button>
    </div>

    <!-- Map Container -->
    <div class="map-container">
        <!-- World Map Canvas -->
        <div class="world-map" id="world-map-container">
            <canvas id="world-map-canvas"></canvas>
        </div>

        <!-- Map Controls -->
        <div class="map-controls">
            <div class="control-group">
                <h4>Filters</h4>
                <button class="filter-btn active" data-filter="all">
                    <span></span> All Locations
                </button>
                <button class="filter-btn" data-filter="cities">
                    <span></span> Cities
                </button>
                <button class="filter-btn" data-filter="quests">
                    <span></span> Quests
                </button>
                <button class="filter-btn" data-filter="shops">
                    <span></span> Shops
                </button>
                <button class="filter-btn" data-filter="dungeons">
                    <span></span> Dungeons
                </button>
            </div>
            <div class="control-group">
                <h4>Zoom</h4>
                <button class="filter-btn" id="zoom-in-btn">
                    <span></span> Zoom In
                </button>
                <button class="filter-btn" id="zoom-out-btn">
                    <span></span> Zoom Out
                </button>
                <button class="filter-btn" id="reset-view-btn">
                    <span></span> Reset View
                </button>
            </div>
        </div>

        <!-- Minimap -->
        <div class="minimap-container">
            <div class="minimap-header">
                 World Overview
            </div>
            <canvas id="minimap-canvas"></canvas>
        </div>

        <!-- Map Legend -->
        <div class="map-legend">
            <div class="legend-title">Map Legend</div>
            <div class="legend-item">
                <span></span>
                <span>Major City</span>
            </div>
            <div class="legend-item">
                <span></span>
                <span>Quest Objective</span>
            </div>
            <div class="legend-item">
                <span></span>
                <span>Merchant Post</span>
            </div>
            <div class="legend-item">
                <span></span>
                <span>Dungeon Entrance</span>
            </div>
            <div class="legend-item">
                <span></span>
                <span>Dark Forest</span>
            </div>
            <div class="legend-item">
                <span></span>
                <span>Mountain Pass</span>
            </div>
        </div>

        <!-- Quest Indicator -->
        <div class="quest-indicator">
            <div class="quest-header">
                <span></span>
                <span>Active Quest</span>
            </div>
            <div class="quest-content">
                <strong>The Duke's Request</strong>
                Travel to the Duke's Warehouse and investigate the mysterious shipments.
            </div>
        </div>
    </div>
</div>

<script>
    // Enhanced and Fixed Map System
    const mapSystem = {
        // Expanded map data with more locations and details
        locations: [
            {
                id: 'valdria',
                name: 'Valdria',
                type: 'city',
                icon: '',
                x: 400, y: 300,
                description: 'The grand capital city of the realm',
                discovered: true,
                visited: true,
                current: true,
                connections: ['warehouse', 'trading_post', 'northgate']
            },
            {
                id: 'warehouse',
                name: "Duke's Warehouse",
                type: 'quest',
                icon: '',
                x: 520, y: 280,
                description: 'Mysterious warehouse with strange shipments',
                discovered: true,
                visited: false,
                quest: true,
                connections: ['valdria', 'forest']
            },
            {
                id: 'forest',
                name: 'Forest of Whispers',
                type: 'forest',
                icon: '',
                x: 650, y: 320,
                description: 'Ancient dark forest filled with secrets',
                discovered: true,
                visited: false,
                connections: ['warehouse', 'ruins', 'crossroads']
            },
            {
                id: 'trading_post',
                name: 'Southern Trading Post',
                type: 'shop',
                icon: '',
                x: 350, y: 450,
                description: 'Bustling merchant gathering place',
                discovered: true,
                visited: true,
                connections: ['valdria', 'crossroads']
            },
            {
                id: 'ruins',
                name: 'Ancient Ruins',
                type: 'dungeon',
                icon: '',
                x: 750, y: 200,
                description: 'Forgotten dungeon with untold treasures',
                discovered: false,
                visited: false,
                connections: ['forest', 'mountains']
            },
            {
                id: 'northgate',
                name: 'Northgate Keep',
                type: 'city',
                icon: '',
                x: 450, y: 150,
                description: 'Northern fortress city',
                discovered: true,
                visited: false,
                connections: ['valdria', 'mountains']
            },
            {
                id: 'crossroads',
                name: 'Crossroads Inn',
                type: 'shop',
                icon: '',
                x: 500, y: 400,
                description: 'Famous tavern and resting place',
                discovered: true,
                visited: false,
                connections: ['trading_post', 'forest']
            },
            {
                id: 'mountains',
                name: 'Dragon\'s Peak',
                type: 'dungeon',
                icon: '',
                x: 600, y: 100,
                description: 'Treacherous mountain pass',
                discovered: false,
                visited: false,
                connections: ['northgate', 'ruins']
            },
            {
                id: 'village',
                name: 'Riverside Village',
                type: 'city',
                icon: '',
                x: 250, y: 350,
                description: 'Peaceful fishing village',
                discovered: true,
                visited: false,
                connections: ['trading_post']
            }
        ],

        // Canvas references
        worldCanvas: null,
        worldCtx: null,
        minimapCanvas: null,
        minimapCtx: null,

        // Map state
        scale: 1,
        offsetX: 0,
        offsetY: 0,
        isDragging: false,
        dragStartX: 0,
        dragStartY: 0,
        activeFilter: 'all',
        hoveredLocation: null,
        animationFrame: 0,

        // Initialize map system
        init() {
            console.log('Initializing map system...');
            this.worldCanvas = document.getElementById('world-map-canvas');
            this.minimapCanvas = document.getElementById('minimap-canvas');

            if (!this.worldCanvas || !this.minimapCanvas) {
                console.error('Canvas elements not found');
                return;
            }

            this.worldCtx = this.worldCanvas.getContext('2d');
            this.minimapCtx = this.minimapCanvas.getContext('2d');

            // Wait for container to be visible
            setTimeout(() => {
                this.setupCanvas();
                this.setupEvents();
                this.render();
                this.renderMinimap();
            }, 50);
        },

        setupCanvas() {
            // Set canvas size based on container
            const container = this.worldCanvas.parentElement;
            const rect = container.getBoundingClientRect();

            this.worldCanvas.width = rect.width || 800;
            this.worldCanvas.height = rect.height || 600;

            const minimapContainer = this.minimapCanvas.parentElement;
            const minimapRect = minimapContainer.getBoundingClientRect();
            this.minimapCanvas.width = minimapRect.width || 280;
            this.minimapCanvas.height = (minimapRect.height - 35) || 185;

            console.log(`Canvas setup: ${this.worldCanvas.width}x${this.worldCanvas.height}`);
        },

        setupEvents() {
            // Filter buttons
            document.querySelectorAll('#map-overlay .filter-btn[data-filter]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    document.querySelectorAll('#map-overlay .filter-btn[data-filter]').forEach(b =>
                        b.classList.remove('active'));
                    btn.classList.add('active');
                    this.activeFilter = btn.dataset.filter;
                    this.render();
                });
            });

            // Zoom buttons
            const zoomIn = document.getElementById('zoom-in-btn');
            const zoomOut = document.getElementById('zoom-out-btn');
            const resetView = document.getElementById('reset-view-btn');

            if (zoomIn) zoomIn.addEventListener('click', () => this.zoomIn());
            if (zoomOut) zoomOut.addEventListener('click', () => this.zoomOut());
            if (resetView) resetView.addEventListener('click', () => this.resetView());

            // Canvas dragging and interaction
            this.worldCanvas.addEventListener('mousedown', (e) => this.startDrag(e));
            this.worldCanvas.addEventListener('mousemove', (e) => this.handleMouseMove(e));
            this.worldCanvas.addEventListener('mouseup', () => this.endDrag());
            this.worldCanvas.addEventListener('mouseleave', () => this.endDrag());
            this.worldCanvas.addEventListener('wheel', (e) => this.handleWheel(e));
            this.worldCanvas.addEventListener('click', (e) => this.handleClick(e));
        },

        render() {
            const ctx = this.worldCtx;
            const canvas = this.worldCanvas;

            if (!ctx || !canvas || canvas.width === 0) return;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Save state
            ctx.save();

            // Apply transformations
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.scale(this.scale, this.scale);
            ctx.translate(-canvas.width / 2 + this.offsetX, -canvas.height / 2 + this.offsetY);

            // Draw parchment background with texture
            this.drawParchmentBackground(ctx, canvas);

            // Draw terrain features
            this.drawTerrain(ctx, canvas);

            // Draw paths between locations
            this.drawPaths(ctx);

            // Draw locations
            this.locations.forEach(loc => {
                if (this.shouldShowLocation(loc)) {
                    this.drawLocation(ctx, loc);
                }
            });

            // Draw fog of war
            this.drawFogOfWar(ctx);

            // Restore state
            ctx.restore();

            // Draw UI elements that shouldn't be transformed
            this.drawCompass(ctx, canvas);
        },

        drawParchmentBackground(ctx, canvas) {
            // Create aged parchment effect
            const gradient = ctx.createRadialGradient(
                canvas.width/2, canvas.height/2, 0,
                canvas.width/2, canvas.height/2, Math.max(canvas.width, canvas.height)
            );
            gradient.addColorStop(0, '#F4E9DC');
            gradient.addColorStop(0.3, '#E8D7C3');
            gradient.addColorStop(0.6, '#D4C4B0');
            gradient.addColorStop(1, '#C8B49C');

            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Add texture overlay
            ctx.globalAlpha = 0.1;
            ctx.strokeStyle = '#8B7355';
            ctx.lineWidth = 0.5;

            // Draw grid lines
            for (let i = 0; i <= canvas.width; i += 40) {
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            for (let j = 0; j <= canvas.height; j += 40) {
                ctx.beginPath();
                ctx.moveTo(0, j);
                ctx.lineTo(canvas.width, j);
                ctx.stroke();
            }

            // Add some random aging marks
            ctx.globalAlpha = 0.05;
            ctx.fillStyle = '#6B5745';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const radius = Math.random() * 30 + 10;
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                ctx.fill();
            }

            ctx.globalAlpha = 1;
        },

        drawTerrain(ctx, canvas) {
            // Draw terrain features for atmosphere
            ctx.globalAlpha = 0.2;

            // Mountains
            ctx.fillStyle = '#6B5745';
            this.drawMountain(ctx, 600, 120, 80);
            this.drawMountain(ctx, 650, 100, 60);
            this.drawMountain(ctx, 550, 90, 70);

            // Forests
            ctx.fillStyle = '#4A6741';
            this.drawForestArea(ctx, 650, 320, 100);
            this.drawForestArea(ctx, 700, 350, 80);

            // Rivers
            ctx.strokeStyle = '#4A90E2';
            ctx.lineWidth = 3;
            ctx.globalAlpha = 0.3;
            ctx.beginPath();
            ctx.moveTo(200, 300);
            ctx.quadraticCurveTo(300, 350, 400, 500);
            ctx.stroke();

            ctx.globalAlpha = 1;
        },

        drawMountain(ctx, x, y, size) {
            ctx.beginPath();
            ctx.moveTo(x - size, y + size);
            ctx.lineTo(x, y - size);
            ctx.lineTo(x + size, y + size);
            ctx.closePath();
            ctx.fill();
        },

        drawForestArea(ctx, x, y, radius) {
            // Draw circular forest area
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
            gradient.addColorStop(0, 'rgba(74, 103, 65, 0.4)');
            gradient.addColorStop(1, 'rgba(74, 103, 65, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();
        },

        drawPaths(ctx) {
            // Draw all connection paths
            ctx.strokeStyle = '#8B7355';
            ctx.lineWidth = 2;
            ctx.globalAlpha = 0.3;
            ctx.setLineDash([5, 5]);

            this.locations.forEach(loc => {
                if (loc.discovered && loc.connections) {
                    loc.connections.forEach(connectionId => {
                        const target = this.locations.find(l => l.id === connectionId);
                        if (target && target.discovered) {
                            ctx.beginPath();
                            ctx.moveTo(loc.x, loc.y);
                            ctx.lineTo(target.x, target.y);
                            ctx.stroke();
                        }
                    });
                }
            });

            ctx.setLineDash([]);
            ctx.globalAlpha = 1;

            // Draw quest path with animation
            const current = this.locations.find(l => l.current);
            const quest = this.locations.find(l => l.quest);

            if (current && quest) {
                ctx.beginPath();
                ctx.moveTo(current.x, current.y);
                ctx.lineTo(quest.x, quest.y);

                // Animated golden path
                const gradient = ctx.createLinearGradient(current.x, current.y, quest.x, quest.y);
                const offset = (this.animationFrame % 100) / 100;
                gradient.addColorStop(Math.max(0, offset - 0.2), 'transparent');
                gradient.addColorStop(offset, '#FFD700');
                gradient.addColorStop(Math.min(1, offset + 0.2), 'transparent');

                ctx.strokeStyle = gradient;
                ctx.lineWidth = 4;
                ctx.shadowColor = 'rgba(255, 215, 0, 0.8)';
                ctx.shadowBlur = 15;
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
        },

        drawLocation(ctx, location) {
            if (!location.discovered && !location.current) return;

            const x = location.x;
            const y = location.y;
            const isHovered = this.hoveredLocation === location.id;
            const scale = isHovered ? 1.3 : 1;

            ctx.save();
            ctx.translate(x, y);
            ctx.scale(scale, scale);

            // Draw shadow
            ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
            ctx.shadowBlur = 10;
            ctx.shadowOffsetX = 3;
            ctx.shadowOffsetY = 3;

            // Location circle with gradient
            const circleGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, 20);
            if (location.visited) {
                circleGradient.addColorStop(0, '#FFD700');
                circleGradient.addColorStop(1, '#D4AF37');
            } else {
                circleGradient.addColorStop(0, '#A88B6D');
                circleGradient.addColorStop(1, '#8B7355');
            }

            ctx.beginPath();
            ctx.arc(0, 0, 18, 0, Math.PI * 2);
            ctx.fillStyle = circleGradient;
            ctx.fill();

            // Border
            ctx.strokeStyle = location.current ? '#FFD700' : '#D4AF37';
            ctx.lineWidth = location.current ? 4 : 2;
            ctx.stroke();

            // Reset shadow for text
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;

            // Icon
            ctx.font = 'bold 20px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillStyle = '#1a1612';
            ctx.fillText(location.icon, 0, 0);

            // Name label with background
            if (isHovered || location.current) {
                ctx.font = 'bold 14px Georgia';
                const textWidth = ctx.measureText(location.name).width;

                // Label background
                ctx.fillStyle = 'rgba(26, 22, 18, 0.9)';
                ctx.fillRect(-textWidth/2 - 8, 25, textWidth + 16, 22);

                // Label border
                ctx.strokeStyle = '#D4AF37';
                ctx.lineWidth = 1;
                ctx.strokeRect(-textWidth/2 - 8, 25, textWidth + 16, 22);

                // Label text
                ctx.fillStyle = '#FFD700';
                ctx.fillText(location.name, 0, 36);
            }

            // Quest pulse animation
            if (location.quest) {
                const time = this.animationFrame / 30;
                const pulseScale = 1 + Math.sin(time) * 0.3;
                ctx.strokeStyle = 'rgba(255, 215, 0, 0.6)';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(0, 0, 25 * pulseScale, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Current location indicator
            if (location.current) {
                ctx.strokeStyle = '#FFD700';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 3]);
                ctx.beginPath();
                ctx.arc(0, 0, 30, 0, Math.PI * 2);
                ctx.stroke();
                ctx.setLineDash([]);
            }

            ctx.restore();
        },

        drawFogOfWar(ctx) {
            this.locations.forEach(loc => {
                if (!loc.discovered) {
                    const gradient = ctx.createRadialGradient(loc.x, loc.y, 20, loc.x, loc.y, 80);
                    gradient.addColorStop(0, 'rgba(26, 22, 18, 0.9)');
                    gradient.addColorStop(1, 'rgba(26, 22, 18, 0)');
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(loc.x, loc.y, 80, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
        },

        drawCompass(ctx, canvas) {
            // Draw compass rose in top right
            const x = canvas.width - 60;
            const y = 60;
            const size = 30;

            ctx.save();
            ctx.translate(x, y);

            // Compass background
            ctx.fillStyle = 'rgba(26, 22, 18, 0.8)';
            ctx.beginPath();
            ctx.arc(0, 0, size + 5, 0, Math.PI * 2);
            ctx.fill();

            // Compass border
            ctx.strokeStyle = '#D4AF37';
            ctx.lineWidth = 2;
            ctx.stroke();

            // North pointer
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.moveTo(0, -size);
            ctx.lineTo(-8, -10);
            ctx.lineTo(0, -5);
            ctx.lineTo(8, -10);
            ctx.closePath();
            ctx.fill();

            // Other directions
            ctx.fillStyle = '#8B7355';
            ctx.font = 'bold 12px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('N', 0, -size - 10);
            ctx.fillText('S', 0, size + 10);
            ctx.fillText('E', size + 10, 0);
            ctx.fillText('W', -size - 10, 0);

            ctx.restore();
        },

        renderMinimap() {
            const ctx = this.minimapCtx;
            const canvas = this.minimapCanvas;

            if (!ctx || !canvas || canvas.width === 0) return;

            // Clear and draw background
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Dark background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(42, 36, 30, 0.9)');
            gradient.addColorStop(1, 'rgba(26, 22, 18, 0.95)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Calculate scale to fit all locations
            const padding = 20;
            const scaleX = (canvas.width - padding * 2) / 800;
            const scaleY = (canvas.height - padding * 2) / 600;
            const scale = Math.min(scaleX, scaleY);

            ctx.save();
            ctx.translate(padding, padding);
            ctx.scale(scale, scale);

            // Draw simplified paths
            ctx.strokeStyle = '#8B7355';
            ctx.lineWidth = 1;
            ctx.globalAlpha = 0.5;

            this.locations.forEach(loc => {
                if (loc.discovered && loc.connections) {
                    loc.connections.forEach(connectionId => {
                        const target = this.locations.find(l => l.id === connectionId);
                        if (target && target.discovered) {
                            ctx.beginPath();
                            ctx.moveTo(loc.x, loc.y);
                            ctx.lineTo(target.x, target.y);
                            ctx.stroke();
                        }
                    });
                }
            });

            ctx.globalAlpha = 1;

            // Draw location dots
            this.locations.forEach(loc => {
                if (loc.discovered) {
                    // Determine color
                    if (loc.current) {
                        ctx.fillStyle = '#FFD700';
                        ctx.strokeStyle = '#FFF';
                    } else if (loc.quest) {
                        ctx.fillStyle = '#FF6B6B';
                        ctx.strokeStyle = '#FFD700';
                    } else if (loc.visited) {
                        ctx.fillStyle = '#D4AF37';
                        ctx.strokeStyle = '#8B7355';
                    } else {
                        ctx.fillStyle = '#8B7355';
                        ctx.strokeStyle = '#6B5745';
                    }

                    // Draw dot
                    ctx.beginPath();
                    ctx.arc(loc.x, loc.y, loc.current ? 6 : 4, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            });

            // Draw viewport indicator
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 2;
            ctx.globalAlpha = 0.5;
            ctx.setLineDash([5, 3]);

            const viewX = (canvas.width / 2 - this.offsetX * scale) / this.scale;
            const viewY = (canvas.height / 2 - this.offsetY * scale) / this.scale;
            const viewW = (canvas.width / this.scale) * scale;
            const viewH = (canvas.height / this.scale) * scale;

            ctx.strokeRect(viewX - viewW/2, viewY - viewH/2, viewW, viewH);
            ctx.setLineDash([]);

            ctx.restore();
        },

        shouldShowLocation(location) {
            if (!location.discovered) return false;
            if (this.activeFilter === 'all') return true;
            if (this.activeFilter === 'cities' && (location.type === 'city')) return true;
            if (this.activeFilter === 'quests' && location.quest) return true;
            if (this.activeFilter === 'shops' && location.type === 'shop') return true;
            if (this.activeFilter === 'dungeons' && location.type === 'dungeon') return true;
            return false;
        },

        handleMouseMove(e) {
            if (this.isDragging) {
                this.drag(e);
            } else {
                // Check for location hover
                const rect = this.worldCanvas.getBoundingClientRect();
                const x = (e.clientX - rect.left - this.worldCanvas.width / 2) / this.scale + this.worldCanvas.width / 2 - this.offsetX;
                const y = (e.clientY - rect.top - this.worldCanvas.height / 2) / this.scale + this.worldCanvas.height / 2 - this.offsetY;

                let foundHover = null;
                this.locations.forEach(loc => {
                    if (loc.discovered) {
                        const dist = Math.sqrt(Math.pow(x - loc.x, 2) + Math.pow(y - loc.y, 2));
                        if (dist < 25) {
                            foundHover = loc.id;
                        }
                    }
                });

                if (foundHover !== this.hoveredLocation) {
                    this.hoveredLocation = foundHover;
                    this.worldCanvas.style.cursor = foundHover ? 'pointer' : 'grab';
                    this.render();
                }
            }
        },

        handleClick(e) {
            if (this.hoveredLocation) {
                const location = this.locations.find(l => l.id === this.hoveredLocation);
                if (location) {
                    console.log('Clicked location:', location.name);
                    // Could trigger travel or show location details
                }
            }
        },

        handleWheel(e) {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = this.scale * delta;

            if (newScale >= 0.5 && newScale <= 3) {
                this.scale = newScale;
                this.render();
                this.renderMinimap();
            }
        },

        startDrag(e) {
            if (!this.hoveredLocation) {
                this.isDragging = true;
                this.dragStartX = e.clientX - this.offsetX;
                this.dragStartY = e.clientY - this.offsetY;
                this.worldCanvas.style.cursor = 'grabbing';
            }
        },

        drag(e) {
            if (this.isDragging) {
                this.offsetX = e.clientX - this.dragStartX;
                this.offsetY = e.clientY - this.dragStartY;
                this.render();
                this.renderMinimap();
            }
        },

        endDrag() {
            this.isDragging = false;
            this.worldCanvas.style.cursor = this.hoveredLocation ? 'pointer' : 'grab';
        },

        zoomIn() {
            if (this.scale < 3) {
                this.scale = Math.min(3, this.scale * 1.2);
                this.render();
                this.renderMinimap();
            }
        },

        zoomOut() {
            if (this.scale > 0.5) {
                this.scale = Math.max(0.5, this.scale / 1.2);
                this.render();
                this.renderMinimap();
            }
        },

        resetView() {
            this.scale = 1;
            this.offsetX = 0;
            this.offsetY = 0;
            this.render();
            this.renderMinimap();
        },

        // Start animation loop
        startAnimation() {
            const animate = () => {
                this.animationFrame++;
                if (document.getElementById('map-overlay')?.classList.contains('active')) {
                    this.render();
                    if (this.animationFrame % 5 === 0) {
                        this.renderMinimap();
                    }
                }
                requestAnimationFrame(animate);
            };
            animate();
        }
    };

    // Initialize when document is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            mapSystem.startAnimation();
        });
    } else {
        mapSystem.startAnimation();
    }
</script>
        <!-- 6. Settings Overlay -->
        <div id="settings-overlay" class="overlay">
    <div class="overlay-backdrop"></div>
    <div class="overlay-content">
        <div class="overlay-header">
            <h2> Settings</h2>
            <button class="close-btn">&times;</button>
        </div>
        <div class="overlay-body">
            <!-- Settings Tabs -->
            <div class="settings-tabs">
                <div class="settings-tab active" data-tab="audio">
                    <span class="tab-icon"></span>
                    <span class="tab-label">Audio</span>
                </div>
                <div class="settings-tab" data-tab="display">
                    <span class="tab-icon"></span>
                    <span class="tab-label">Display</span>
                </div>
                <div class="settings-tab" data-tab="controls">
                    <span class="tab-icon"></span>
                    <span class="tab-label">Controls</span>
                </div>
                <div class="settings-tab" data-tab="game">
                    <span class="tab-icon"></span>
                    <span class="tab-label">Game</span>
                </div>
            </div>

            <!-- Audio Settings Tab -->
            <div class="settings-tab-content" id="audio-settings">
                <div class="setting-group">
                    <div class="setting-label">Master Volume</div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="80" class="volume-slider master-volume">
                        <span class="volume-value">80%</span>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">Music Volume</div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="70" class="volume-slider music-volume">
                        <span class="volume-value">70%</span>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">SFX Volume</div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="85" class="volume-slider sfx-volume">
                        <span class="volume-value">85%</span>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-checkbox">
                        <input type="checkbox" id="ambience-toggle" checked>
                        <label for="ambience-toggle">Enable Ambience Sounds</label>
                    </div>
                </div>
            </div>

            <!-- Display Settings Tab (Hidden) -->
            <div class="settings-tab-content hidden" id="display-settings">
                <div class="setting-group">
                    <div class="setting-label">Brightness</div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="75" class="volume-slider">
                        <span class="volume-value">75%</span>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">Contrast</div>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="100" class="volume-slider">
                        <span class="volume-value">100%</span>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-checkbox">
                        <input type="checkbox" id="fullscreen-toggle">
                        <label for="fullscreen-toggle">Fullscreen Mode</label>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-checkbox">
                        <input type="checkbox" id="vsync-toggle" checked>
                        <label for="vsync-toggle">Enable V-Sync</label>
                    </div>
                </div>
            </div>

            <!-- Controls Settings Tab (Hidden) -->
            <div class="settings-tab-content hidden" id="controls-settings">
                <div class="setting-group">
                    <div class="setting-label">Mouse Sensitivity</div>
                    <div class="slider-container">
                        <input type="range" min="1" max="10" value="5" class="volume-slider">
                        <span class="volume-value">5/10</span>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-label">Camera Speed</div>
                    <div class="slider-container">
                        <input type="range" min="1" max="10" value="6" class="volume-slider">
                        <span class="volume-value">6/10</span>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-checkbox">
                        <input type="checkbox" id="invert-y-toggle">
                        <label for="invert-y-toggle">Invert Y-Axis</label>
                    </div>
                </div>

                <div class="setting-group">
                    <div class="setting-checkbox">
                        <input type="checkbox" id="controller-toggle">
                        <label for="controller-toggle">Controller Support</label>
                    </div>
                </div>
            </div>

            <!-- Game Settings Tab (Hidden) -->
            <div class="settings-tab-content hidden" id="game-settings">
                <div class="game-actions">
                    <button class="game-action-btn save-btn"> Save Game</button>
                    <button class="game-action-btn load-btn"> Load Game</button>
                    <button class="game-action-btn menu-btn"> Return to Menu</button>
                </div>

                <div class="game-info">
                    <div class="info-item">
                        <span class="info-label">Current Save:</span>
                        <span class="info-value">Valdria - Act 1, Turn 3</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Playtime:</span>
                        <span class="info-value">2 hours 45 minutes</span>
                    </div>
                </div>

                <div class="game-version">
                    v1.0 - The Arcane Codex
                </div>
            </div>
        </div>
    </div>
</div>
    </div>

        <script>
        // ============================================
        // OVERLAY SYSTEM - All 6 Game Overlays
        // ============================================

        // Overlay IDs mapped to sidebar buttons
        const overlayMap = {
            0: 'character-overlay',  // Character (C)
            1: 'inventory-overlay',  // Inventory (I)
            2: 'skills-overlay',     // Skills (K)
            3: 'quests-overlay',     // Quests (J)
            4: 'map-overlay',        // Map (M)
            5: 'settings-overlay'    // Settings (ESC)
        };

        // Track which overlay is currently active
        let activeOverlay = null;

        /**
         * Opens a specific overlay by ID
         * Closes any previously open overlay
         * Adds .active class to show the overlay
         */
        function openOverlay(overlayId) {
            // Close any existing open overlays
            closeAllOverlays();

            // Get the overlay element
            const overlay = document.getElementById(overlayId);
            if (overlay) {
                overlay.classList.add('active');
                activeOverlay = overlayId;
                console.log(`Opened overlay: ${overlayId}`);

                // Initialize map system when map overlay opens
                if (overlayId === 'map-overlay') {
                    setTimeout(() => {
                        mapSystem.init();
                        console.log('Map system initialized');
                    }, 100);
                }
            }
        }

        /**
         * Closes all open overlays
         * Removes .active class from all overlay elements
         */
        function closeAllOverlays() {
            const overlays = document.querySelectorAll('.game-overlay.active, .overlay.active');
            overlays.forEach(overlay => {
                overlay.classList.remove('active');
            });
            activeOverlay = null;
            console.log('Closed all overlays');
        }

        /**
         * Keyboard event handler for overlay shortcuts
         * C = Character, I = Inventory, K = Skills, J = Quests, M = Map
         * ESC = Settings or close active overlay
         */
        document.addEventListener('keydown', function(e) {
            const keyMap = {
                'c': 0,        // Character overlay
                'i': 1,        // Inventory overlay
                'k': 2,        // Skills overlay
                'j': 3,        // Quests overlay
                'm': 4,        // Map overlay
                'escape': 5    // Settings overlay
            };

            const key = e.key.toLowerCase();

            // Check if key matches an overlay shortcut
            if (keyMap[key] !== undefined) {
                e.preventDefault();

                // If ESC is pressed and an overlay is open, close it first
                if (key === 'escape' && activeOverlay) {
                    closeAllOverlays();
                } else if (key === 'escape') {
                    // If no overlay is open, open Settings
                    openOverlay(overlayMap[5]);
                } else {
                    // For other keys, toggle overlay open/close
                    const overlayId = overlayMap[keyMap[key]];
                    if (activeOverlay === overlayId) {
                        closeAllOverlays();
                    } else {
                        openOverlay(overlayId);
                    }
                }
            }
        });

        /**
         * Setup event listeners for overlay backdrops
         * Clicking backdrop closes the overlay
         */
        document.querySelectorAll('.overlay-backdrop').forEach(backdrop => {
            backdrop.addEventListener('click', function() {
                closeAllOverlays();
            });
        });

        /**
         * Setup event listeners for close buttons
         * Clicking X button closes the overlay
         */
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                closeAllOverlays();
            });
        });

        /**
         * Setup event listeners for sidebar buttons
         * Maps button clicks to corresponding overlays
         * Button order: Character, Inventory, Skills, Quests, Map, Settings
         */
        document.querySelectorAll('.left-panel .side-btn').forEach((btn, index) => {
            btn.addEventListener('click', function() {
                const overlayId = overlayMap[index];

                // Toggle: if already open, close it; otherwise open it
                if (activeOverlay === overlayId) {
                    closeAllOverlays();
                } else {
                    openOverlay(overlayId);
                }

                // Visual feedback
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        this.style.transform = '';
                    }, 100);
                }, 100);
            });
        });

        console.log('Overlay system initialized - Press C/I/K/J/M or ESC to open overlays');

        // === Choice Button Interactions ===
        document.querySelectorAll('.choice-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const choice = this.textContent.trim();
                console.log('Player chose:', choice);

                // Visual feedback
                this.style.background = 'linear-gradient(135deg, rgba(212, 175, 55, 0.5), rgba(139, 115, 85, 0.5))';
                this.style.borderColor = '#FFD700';

                // Disable all choice buttons after selection
                document.querySelectorAll('.choice-btn').forEach(b => {
                    b.style.opacity = '0.5';
                    b.style.pointerEvents = 'none';
                });

                // Submit choice to backend
                submitChoice(choice);
            });
        });

        // Submit choice to API and handle response
        async function submitChoice(choice) {
            try {
                // Show loading state
                const narrativePanel = document.querySelector('.scene-narrative-panel');
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'act-header';
                loadingDiv.style.marginTop = '25px';
                loadingDiv.innerHTML = ' Processing your choice...';
                narrativePanel.appendChild(loadingDiv);

                // POST to API
                const response = await fetch('/api/scenario/choice', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        choice: choice,
                        timestamp: new Date().toISOString()
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Remove loading message
                loadingDiv.remove();

                // Display consequences
                displayConsequences(data);

            } catch (error) {
                console.error('Error submitting choice:', error);

                // Show error message to user
                const errorDiv = document.createElement('div');
                errorDiv.className = 'narrative-text';
                errorDiv.style.color = '#CD5C5C';
                errorDiv.style.marginTop = '20px';
                errorDiv.innerHTML = ` <strong>Connection Error:</strong> Unable to process your choice. ${error.message}`;
                document.querySelector('.scene-narrative-panel').appendChild(errorDiv);
            }
        }

        // Display consequences and Divine Council responses
        function displayConsequences(data) {
            const narrativePanel = document.querySelector('.scene-narrative-panel');

            // Add consequence narrative
            if (data.consequence) {
                const consequenceDiv = document.createElement('div');
                consequenceDiv.className = 'narrative-text';
                consequenceDiv.style.marginTop = '20px';
                consequenceDiv.innerHTML = data.consequence;
                narrativePanel.appendChild(consequenceDiv);
            }

            // Add Divine Council header
            if (data.divineCouncil && data.divineCouncil.length > 0) {
                const councilHeader = document.createElement('div');
                councilHeader.className = 'act-header';
                councilHeader.style.marginTop = '25px';
                councilHeader.innerHTML = ' Divine Council Convenes';
                narrativePanel.appendChild(councilHeader);

                // Add each god's speech
                data.divineCouncil.forEach((godSpeech, index) => {
                    setTimeout(() => {
                        const speechDiv = document.createElement('div');
                        speechDiv.className = `god-speech ${godSpeech.god.toLowerCase()}`;
                        speechDiv.innerHTML = `
                            <img src="images/god_${godSpeech.god.toLowerCase()}.svg" alt="${godSpeech.god}" class="god-icon">
                            <div class="god-content">
                                <div class="god-name">${godSpeech.icon} ${godSpeech.god.toUpperCase()} SPEAKS</div>
                                <div class="god-text">"${godSpeech.speech}"</div>
                            </div>
                        `;
                        narrativePanel.appendChild(speechDiv);

                        // Scroll to show new content
                        speechDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, index * 800); // Stagger speeches for dramatic effect
                });
            }

            // Update game state if provided
            if (data.stateUpdates) {
                updateGameState(data.stateUpdates);
            }
        }

        // Update game state based on API response
        function updateGameState(updates) {
            // Update trust if changed
            if (updates.trust !== undefined) {
                console.log('Trust updated to:', updates.trust);
                // Update trust bar visualization (if implemented)
            }

            // Update divine favor if changed
            if (updates.divineFavor) {
                console.log('Divine favor updated:', updates.divineFavor);
                // Update divine favor bars (if implemented)
            }

            // Update NPC approval if changed
            if (updates.npcApproval) {
                console.log('NPC approval updated:', updates.npcApproval);
                // Update NPC status (if implemented)
            }
        }

        // === Action Slot Handlers ===
        document.querySelectorAll('.action-slot').forEach((slot, index) => {
            slot.addEventListener('click', function() {
                const key = index + 1;
                console.log(`Action slot ${key} activated`);

                // Visual feedback
                this.style.transform = 'scale(0.9) translateY(-3px)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 200);

                // Activate skill/item in slot
                activateSlot(index + 1, this);
            });
        });

        // Action bar slot activation
        function activateSlot(slotNumber, slotElement) {
            // Check if slot is on cooldown
            if (slotElement.classList.contains('on-cooldown')) {
                console.log(`Slot ${slotNumber} is on cooldown`);

                // Shake animation for cooldown feedback
                slotElement.style.animation = 'shake 0.3s';
                setTimeout(() => {
                    slotElement.style.animation = '';
                }, 300);
                return;
            }

            // Get slot data
            const slotEmoji = slotElement.textContent.trim();
            const slotKey = slotElement.dataset.key || slotNumber;

            console.log(`Activating slot ${slotNumber} (${slotEmoji})`);

            // Simulate ability activation
            showAbilityActivation(slotNumber, slotEmoji);

            // Apply cooldown (example: 3 seconds)
            applyCooldown(slotElement, 3000);

            // POST to backend if needed for game state updates
            // fetch('/api/ability/activate', {...})
        }

        // Show ability activation visual feedback
        function showAbilityActivation(slotNumber, abilityName) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, rgba(212, 175, 55, 0.95), rgba(139, 115, 85, 0.95));
                border: 3px solid #FFD700;
                border-radius: 10px;
                padding: 20px 40px;
                font-family: 'Cinzel', serif;
                font-size: 28px;
                color: #000;
                z-index: 9999;
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
                animation: abilityPop 0.6s ease;
            `;
            notification.textContent = `${abilityName} Activated!`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translate(-50%, -50%) scale(0.5)';
                notification.style.transition = 'all 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 1000);
        }

        // Apply cooldown to slot
        function applyCooldown(slotElement, duration) {
            slotElement.classList.add('on-cooldown');
            slotElement.style.opacity = '0.5';
            slotElement.style.filter = 'grayscale(1)';
            slotElement.style.pointerEvents = 'none';

            // Cooldown overlay
            const cooldownOverlay = document.createElement('div');
            cooldownOverlay.style.cssText = `
                position: absolute;
                inset: 0;
                background: rgba(0, 0, 0, 0.7);
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-family: 'Cinzel', serif;
                font-size: 24px;
                color: #CD5C5C;
                font-weight: 700;
                animation: cooldownFade ${duration}ms linear;
            `;

            let remainingSeconds = Math.ceil(duration / 1000);
            cooldownOverlay.textContent = remainingSeconds;
            slotElement.appendChild(cooldownOverlay);

            // Update countdown every second
            const countdownInterval = setInterval(() => {
                remainingSeconds--;
                if (remainingSeconds > 0) {
                    cooldownOverlay.textContent = remainingSeconds;
                } else {
                    clearInterval(countdownInterval);
                }
            }, 1000);

            // Remove cooldown after duration
            setTimeout(() => {
                slotElement.classList.remove('on-cooldown');
                slotElement.style.opacity = '';
                slotElement.style.filter = '';
                slotElement.style.pointerEvents = '';
                cooldownOverlay.remove();
            }, duration);
        }

        // === Party Member Card Handlers ===
        document.querySelectorAll('.party-member').forEach(member => {
            member.addEventListener('click', function() {
                const name = this.querySelector('.member-name').textContent;
                console.log(`${name} selected`);

                // Highlight selected member
                document.querySelectorAll('.party-member').forEach(m => {
                    m.style.borderColor = '#8B7355';
                    m.style.background = 'rgba(0, 0, 0, 0.4)';
                });
                this.style.borderColor = '#FFD700';
                this.style.background = 'rgba(212, 175, 55, 0.2)';

                // Show member details panel
                const memberData = {
                    name: this.querySelector('.member-name').textContent,
                    emoji: this.textContent.split('\n')[0].trim(),
                    hp: this.querySelector('.member-hp')?.textContent || '100/100',
                    role: this.dataset.role || 'Unknown'
                };
                showMemberDetails(memberData);
            });
        });

        // Show party member details in a modal panel
        function showMemberDetails(memberData) {
            // Remove existing details panel if any
            const existing = document.querySelector('.member-details-modal');
            if (existing) {
                existing.remove();
            }

            // Create modal
            const modal = document.createElement('div');
            modal.className = 'member-details-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.85);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;

            // Create panel
            const panel = document.createElement('div');
            panel.style.cssText = `
                background: linear-gradient(135deg, rgba(42, 36, 30, 0.98) 0%, rgba(26, 22, 18, 0.98) 100%);
                border: 3px solid #D4AF37;
                border-radius: 15px;
                padding: 30px;
                max-width: 500px;
                width: 90%;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9), 0 0 40px rgba(212, 175, 55, 0.3);
                animation: slideUp 0.3s ease;
            `;

            panel.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="font-family: 'Cinzel', serif; font-size: 32px; color: #D4AF37; margin: 0;">
                        ${memberData.emoji} ${memberData.name}
                    </h2>
                    <button class="close-details-btn" style="
                        background: rgba(205, 92, 92, 0.3);
                        border: 2px solid #CD5C5C;
                        color: #CD5C5C;
                        font-size: 24px;
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    "></button>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-family: 'Cinzel', serif; font-size: 14px; color: #8B7355; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Role
                    </div>
                    <div style="font-family: 'Yrsa', serif; font-size: 20px; color: #D4AF37;">
                        ${memberData.role}
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-family: 'Cinzel', serif; font-size: 14px; color: #8B7355; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Health
                    </div>
                    <div style="
                        background: rgba(0, 0, 0, 0.5);
                        border: 2px solid #8B7355;
                        border-radius: 8px;
                        padding: 8px;
                        font-family: 'Yrsa', serif;
                        font-size: 18px;
                        color: #90EE90;
                    ">
                         ${memberData.hp}
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-family: 'Cinzel', serif; font-size: 14px; color: #8B7355; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Equipment
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                        <div style="background: rgba(0, 0, 0, 0.5); border: 2px solid #8B7355; border-radius: 6px; padding: 10px; text-align: center; color: #D4AF37;">
                             Weapon
                        </div>
                        <div style="background: rgba(0, 0, 0, 0.5); border: 2px solid #8B7355; border-radius: 6px; padding: 10px; text-align: center; color: #D4AF37;">
                             Armor
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-family: 'Cinzel', serif; font-size: 14px; color: #8B7355; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        Active Effects
                    </div>
                    <div style="
                        background: rgba(139, 69, 139, 0.2);
                        border: 2px solid #8B458B;
                        border-radius: 6px;
                        padding: 12px;
                        font-family: 'Yrsa', serif;
                        font-size: 16px;
                        color: #DA70D6;
                        font-style: italic;
                    ">
                         No active effects
                    </div>
                </div>
            `;

            modal.appendChild(panel);
            document.body.appendChild(modal);

            // Close button handler
            panel.querySelector('.close-details-btn').addEventListener('click', () => {
                modal.style.opacity = '0';
                setTimeout(() => modal.remove(), 300);
            });

            // Close on backdrop click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.opacity = '0';
                    setTimeout(() => modal.remove(), 300);
                }
            });

            // Close button hover effect
            const closeBtn = panel.querySelector('.close-details-btn');
            closeBtn.addEventListener('mouseenter', () => {
                closeBtn.style.background = 'rgba(205, 92, 92, 0.6)';
                closeBtn.style.transform = 'scale(1.1)';
            });
            closeBtn.addEventListener('mouseleave', () => {
                closeBtn.style.background = 'rgba(205, 92, 92, 0.3)';
                closeBtn.style.transform = 'scale(1)';
            });
        }


        // === Scenario Loading Functions ===
        function loadNewScenario(scenarioData) {
            // Update narrative text
            // Update whispers
            // Update choices
            // Add Divine Council dialogue when choice is made
            console.log('Loading scenario:', scenarioData.theme);
        }

        function showDivineCouncilResponse(councilData) {
            // councilData contains god speeches and judgment
            // Animate god speech boxes appearing one by one
            const speeches = document.querySelectorAll('.god-speech');
            speeches.forEach((speech, index) => {
                setTimeout(() => {
                    speech.style.opacity = '0';
                    speech.style.transform = 'translateY(20px)';
                    speech.style.transition = 'all 0.5s ease';
                    setTimeout(() => {
                        speech.style.opacity = '1';
                        speech.style.transform = 'translateY(0)';
                    }, 50);
                }, index * 200);
            });
        }

        
        // ============================================
        // INVENTORY OVERLAY HANDLERS
        // ============================================

    // Inventory Overlay Management
    const inventoryOverlay = document.getElementById('inventory-overlay');
    const closeBtn = inventoryOverlay.querySelector('.close-btn');
    const filterBtns = inventoryOverlay.querySelectorAll('.filter-btn');
    const detailsContent = inventoryOverlay.querySelector('.details-content');

    // Close button handler
    if (closeBtn) {
        closeBtn.addEventListener('click', () => {
            inventoryOverlay.classList.remove('active');
        });
    }

    // Filter button handlers
    filterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            filterBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const filter = btn.getAttribute('data-filter');
            console.log('Filter changed to:', filter);
        });
    });

    // Item hover handlers for detail display
    const allItems = inventoryOverlay.querySelectorAll('[data-item-id]');
    allItems.forEach(item => {
        item.addEventListener('mouseenter', (e) => {
            const tooltip = item.getAttribute('data-tooltip');
            if (tooltip) {
                detailsContent.innerHTML = `<p>${tooltip}</p>`;
            }
        });

        item.addEventListener('mouseleave', () => {
            detailsContent.innerHTML = '<p class="details-placeholder">Hover over an item to view details</p>';
        });
    });

    // Keyboard toggle (I key)

        // ============================================
        // ADDITIONAL OVERLAY ENHANCEMENTS
        // ============================================

// Quest Tab Switching
document.querySelectorAll('.quest-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');

        // Update active tab
        document.querySelectorAll('.quest-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // Update visible content
        document.getElementById('active-quests').classList.toggle('hidden');
        document.getElementById('completed-quests').classList.toggle('hidden');
    });
});

// Settings Tab Switching
document.querySelectorAll('.settings-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');

        // Update active tab
        document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // Update visible content
        document.querySelectorAll('.settings-tab-content').forEach(content => {
            content.classList.add('hidden');
        });

        document.getElementById(`${tabName}-settings`).classList.remove('hidden');
    });
});

// Volume slider handlers
document.querySelectorAll('.volume-slider').forEach(slider => {
    slider.addEventListener('input', function() {
        const valueDisplay = this.parentElement.querySelector('.volume-value');
        if (valueDisplay) {
            valueDisplay.textContent = this.value + '%';
        }
    });
});

console.log('Overlay enhancements loaded successfully');


        
        
        // QUEST/SETTINGS TAB SWITCHING - INTEGRATED
        // ============================================
// Quest Tab Switching
document.querySelectorAll('.quest-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');

        // Update active tab
        document.querySelectorAll('.quest-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // Update visible content
        document.getElementById('active-quests').classList.toggle('hidden');
        document.getElementById('completed-quests').classList.toggle('hidden');
    });
});

// Settings Tab Switching
document.querySelectorAll('.settings-tab').forEach(tab => {
    tab.addEventListener('click', function() {
        const tabName = this.getAttribute('data-tab');

        // Update active tab
        document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');

        // Update visible content
        document.querySelectorAll('.settings-tab-content').forEach(content => {
            content.classList.add('hidden');
        });

        document.getElementById(`${tabName}-settings`).classList.remove('hidden');
    });
});

// Volume slider handlers
document.querySelectorAll('.volume-slider').forEach(slider => {
    slider.addEventListener('input', function() {
        const valueDisplay = this.parentElement.querySelector('.volume-value');
        if (valueDisplay) {
            valueDisplay.textContent = this.value + '%';
        }
    });
});

console.log('Overlay enhancements loaded successfully');

        // ========================================
        // PHASE 3A: DYNAMIC DATA LOADING
        // ========================================

        /**
         * Load all game data from backend APIs
         * Call this on page load and after major game events
         */
        async function loadGameData() {
            console.log('Loading game data from backend...');

            try {
                // Load all data in parallel for performance
                await Promise.all([
                    loadCharacterStats(),
                    loadInventoryData(),
                    loadDivineFavor(),
                    loadPartyTrust(),
                    loadNPCData(),
                    loadQuestData()
                ]);

                console.log('All game data loaded successfully');
            } catch (error) {
                console.error('Error loading game data:', error);
            }
        }

        /**
         * Load character stats from /api/character/stats
         * Updates Character overlay with current stats
         */
        async function loadCharacterStats() {
            try {
                // TODO: Uncomment when backend ready
                // const response = await fetch('/api/character/stats');
                // const data = await response.json();

                // Mock data for now
                const data = {
                    name: 'Aldric',
                    class: 'Fighter',
                    level: 5,
                    stats: {
                        strength: 16,
                        dexterity: 14,
                        constitution: 15,
                        intelligence: 10,
                        wisdom: 12,
                        charisma: 8
                    },
                    hp: { current: 45, max: 50 }
                };

                // Update UI elements
                updateCharacterDisplay(data);

                return data;
            } catch (error) {
                console.error('Failed to load character stats:', error);
                throw error;
            }
        }

        /**
         * Update character display elements with loaded data
         */
        function updateCharacterDisplay(data) {
            // Update character name
            const nameElements = document.querySelectorAll('.character-name');
            nameElements.forEach(el => el.textContent = data.name);

            // Update stat values
            if (data.stats) {
                const statMap = {
                    'strength': data.stats.strength,
                    'dexterity': data.stats.dexterity,
                    'constitution': data.stats.constitution,
                    'intelligence': data.stats.intelligence,
                    'wisdom': data.stats.wisdom,
                    'charisma': data.stats.charisma
                };

                Object.keys(statMap).forEach(stat => {
                    const statElement = document.querySelector(`.stat-${stat} .stat-value`);
                    if (statElement) {
                        statElement.textContent = statMap[stat];
                    }
                });
            }

            // Update HP display
            if (data.hp) {
                const hpElements = document.querySelectorAll('.hp-value');
                hpElements.forEach(el => {
                    el.textContent = `${data.hp.current}/${data.hp.max}`;
                });
            }

            console.log('Character display updated');
        }

        /**
         * Load inventory data from /api/inventory
         * Updates Inventory overlay with current items
         */
        async function loadInventoryData() {
            try {
                // TODO: Uncomment when backend ready
                // const response = await fetch('/api/inventory');
                // const data = await response.json();

                // Mock data for now
                const data = {
                    items: [
                        { name: 'Potion of Healing', quantity: 3, rarity: 'common' },
                        { name: 'Ancient Scroll', quantity: 1, rarity: 'rare' }
                    ],
                    gold: 150
                };

                updateInventoryDisplay(data);

                return data;
            } catch (error) {
                console.error('Failed to load inventory:', error);
                throw error;
            }
        }

        /**
         * Update inventory display elements
         */
        function updateInventoryDisplay(data) {
            // Update inventory grid (when implemented)
            console.log('Inventory data loaded:', data);

            // Update gold display
            if (data.gold !== undefined) {
                const goldElements = document.querySelectorAll('.gold-amount');
                goldElements.forEach(el => el.textContent = data.gold);
            }

            console.log('Inventory display updated');
        }

        /**
         * Load divine favor values from /api/divine-favor
         * Updates Character overlay Divine Favor bars
         */
        async function loadDivineFavor() {
            try {
                // TODO: Uncomment when backend ready
                // const response = await fetch('/api/divine-favor');
                // const data = await response.json();

                // Mock data for now
                const data = {
                    valdris: 15,
                    kaitha: -10,
                    morvane: 20,
                    sylara: 5,
                    korvan: 25,
                    athena: 10,
                    mercus: -5
                };

                updateDivineFavorDisplay(data);

                return data;
            } catch (error) {
                console.error('Failed to load divine favor:', error);
                throw error;
            }
        }

        /**
         * Update divine favor bar displays
         */
        function updateDivineFavorDisplay(favorData) {
            Object.keys(favorData).forEach(god => {
                const value = favorData[god];
                const percentage = Math.max(0, Math.min(100, ((value + 50) / 100) * 100));

                // Update bar width
                const barElement = document.querySelector(`.${god}-bar`);
                if (barElement) {
                    barElement.style.width = `${percentage}%`;
                }

                // Update value display
                const valueElement = barElement?.parentElement?.querySelector('.divine-value');
                if (valueElement) {
                    valueElement.textContent = value > 0 ? `+${value}` : value;
                    valueElement.classList.toggle('negative', value < 0);
                }
            });

            console.log('Divine favor display updated');
        }

        /**
         * Load party trust from /api/party/trust
         * Updates trust meter visualization
         */
        async function loadPartyTrust() {
            try {
                // TODO: Uncomment when backend ready
                // const response = await fetch('/api/party/trust');
                // const data = await response.json();

                // Mock data for now
                const data = {
                    trust: 65,
                    tier: 'Professional'
                };

                updateTrustDisplay(data);

                return data;
            } catch (error) {
                console.error('Failed to load party trust:', error);
                throw error;
            }
        }

        /**
         * Update trust meter display
         */
        function updateTrustDisplay(trustData) {
            // Update trust bar (when implemented in UI)
            console.log('Trust data loaded:', trustData);

            // This would update a trust bar visualization
            const trustElements = document.querySelectorAll('.trust-value');
            trustElements.forEach(el => {
                el.textContent = `${trustData.trust}%`;
            });

            console.log('Trust display updated');
        }

        /**
         * Load NPC data from /api/npcs
         * Updates party member cards
         */
        async function loadNPCData() {
            try {
                // TODO: Uncomment when backend ready
                // const response = await fetch('/api/npcs');
                // const data = await response.json();

                // Mock data for now
                const data = {
                    npcs: [
                        { name: 'Grimsby', approval: 75, hp: { current: 30, max: 40 } },
                        { name: 'Renna', approval: 50, hp: { current: 25, max: 35 } }
                    ]
                };

                updateNPCDisplay(data);

                return data;
            } catch (error) {
                console.error('Failed to load NPC data:', error);
                throw error;
            }
        }

        /**
         * Update NPC/party member displays
         */
        function updateNPCDisplay(npcData) {
            console.log('NPC data loaded:', npcData);

            // This would update party member cards in the UI
            npcData.npcs.forEach((npc, index) => {
                const memberCard = document.querySelectorAll('.party-member')[index];
                if (memberCard) {
                    const hpElement = memberCard.querySelector('.member-hp');
                    if (hpElement) {
                        hpElement.textContent = `${npc.hp.current}/${npc.hp.max}`;
                    }
                }
            });

            console.log('NPC display updated');
        }

        /**
         * Load quest data from /api/quests
         * Updates Quest overlay
         */
        async function loadQuestData() {
            try {
                // TODO: Uncomment when backend ready
                // const response = await fetch('/api/quests');
                // const data = await response.json();

                // Mock data for now
                const data = {
                    quests: [
                        {
                            title: "The Warehouse Heist",
                            status: 'active',
                            objectives: [
                                { text: 'Infiltrate warehouse', completed: false },
                                { text: 'Find medicine', completed: false }
                            ]
                        }
                    ]
                };

                updateQuestDisplay(data);

                return data;
            } catch (error) {
                console.error('Failed to load quest data:', error);
                throw error;
            }
        }

        /**
         * Update quest display
         */
        function updateQuestDisplay(questData) {
            console.log('Quest data loaded:', questData);
            // This would populate the quest overlay with active quests
            console.log('Quest display updated');
        }

        // Load all game data on page load
        // Uncomment this when backend APIs are ready
        // loadGameData();


        console.log('The Arcane Codex UI loaded - All interactive elements ready');
    </script>
</body>
</html>
