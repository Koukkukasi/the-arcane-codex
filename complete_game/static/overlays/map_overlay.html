<!-- Map Overlay - The Arcane Codex -->
<div id="mapOverlay" class="map-overlay" role="dialog" aria-modal="true" aria-labelledby="mapTitle">
    <div class="map-backdrop" data-close-map></div>
    <div class="map-container">
        <!-- Close Button -->
        <button class="map-close" aria-label="Close Map" data-close-map>
            <span class="close-icon">‚úï</span>
        </button>

        <!-- Map Header -->
        <header class="map-header">
            <div class="map-title-section">
                <h1 id="mapTitle" class="map-title">
                    <span class="title-icon">üó∫Ô∏è</span>
                    World of Arcania
                </h1>
                <div class="map-coordinates">
                    <span class="coord-label">Current Location:</span>
                    <span class="coord-value" data-current-location>Unknown</span>
                </div>
            </div>

            <div class="map-controls">
                <!-- Zoom Controls -->
                <div class="zoom-controls">
                    <button class="zoom-btn" data-zoom-in aria-label="Zoom In">
                        <span class="zoom-icon">+</span>
                    </button>
                    <span class="zoom-level" data-zoom-level>100%</span>
                    <button class="zoom-btn" data-zoom-out aria-label="Zoom Out">
                        <span class="zoom-icon">‚àí</span>
                    </button>
                </div>

                <!-- View Toggle -->
                <button class="view-toggle-btn" data-toggle-3d aria-label="Toggle 3D View">
                    <span class="view-icon">üåê</span>
                    <span class="view-label">2D View</span>
                </button>

                <!-- Filter Toggle -->
                <button class="filter-toggle-btn" data-toggle-filters aria-label="Toggle Filters">
                    <span class="filter-icon">üîç</span>
                    <span class="filter-label">Filters</span>
                </button>
            </div>
        </header>

        <!-- Map Content Grid -->
        <div class="map-content">
            <!-- Main Map Canvas -->
            <div class="map-canvas-wrapper">
                <canvas id="worldMapCanvas" class="map-canvas"></canvas>

                <!-- Fog of War Overlay -->
                <canvas id="fogOfWarCanvas" class="fog-canvas"></canvas>

                <!-- Interactive POI Markers -->
                <div class="poi-markers-container" data-poi-container>
                    <!-- POI markers will be dynamically inserted here -->
                </div>

                <!-- Player Marker -->
                <div class="player-marker" data-player-marker>
                    <div class="marker-pulse"></div>
                    <div class="marker-icon">üìç</div>
                    <div class="marker-label">You</div>
                </div>

                <!-- Map Grid Overlay (optional) -->
                <div class="map-grid" data-map-grid></div>
            </div>

            <!-- Right Sidebar -->
            <aside class="map-sidebar">
                <!-- Legend Panel -->
                <section class="legend-panel">
                    <h2 class="panel-title">
                        <span class="panel-icon">üìã</span>
                        Legend
                    </h2>
                    <div class="legend-grid">
                        <div class="legend-item">
                            <span class="legend-icon shop">üè™</span>
                            <span class="legend-label">Shops</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon quest">‚ùó</span>
                            <span class="legend-label">Quests</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon npc">üë§</span>
                            <span class="legend-label">NPCs</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon exit">üö™</span>
                            <span class="legend-label">Exits</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon danger">‚ö†Ô∏è</span>
                            <span class="legend-label">Danger</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon waypoint">üèÅ</span>
                            <span class="legend-label">Waypoint</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon treasure">üíé</span>
                            <span class="legend-label">Treasure</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon boss">üëπ</span>
                            <span class="legend-label">Boss</span>
                        </div>
                    </div>
                </section>

                <!-- Filter Panel (collapsible) -->
                <section class="filter-panel collapsed" data-filter-panel>
                    <h2 class="panel-title">
                        <span class="panel-icon">üîç</span>
                        Filters
                    </h2>
                    <div class="filter-content">
                        <div class="filter-group">
                            <label class="filter-checkbox">
                                <input type="checkbox" checked data-filter="shops">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Show Shops</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked data-filter="quests">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Show Quests</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked data-filter="npcs">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Show NPCs</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked data-filter="danger">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Show Danger Zones</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked data-filter="waypoints">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Show Waypoints</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="checkbox" checked data-filter="fog">
                                <span class="checkbox-custom"></span>
                                <span class="checkbox-label">Fog of War</span>
                            </label>
                        </div>
                    </div>
                </section>

                <!-- Discovered Locations Panel -->
                <section class="locations-panel">
                    <h2 class="panel-title">
                        <span class="panel-icon">üè∞</span>
                        Discovered Locations
                    </h2>
                    <div class="locations-list" data-locations-list>
                        <div class="location-item" data-location-id="town-square">
                            <div class="location-icon">üèõÔ∏è</div>
                            <div class="location-info">
                                <h3 class="location-name">Town Square</h3>
                                <p class="location-description">Central marketplace</p>
                            </div>
                            <button class="travel-btn" data-travel-to="town-square">
                                <span class="travel-icon">üöÄ</span>
                                Travel
                            </button>
                        </div>

                        <div class="location-item" data-location-id="dark-forest">
                            <div class="location-icon">üå≤</div>
                            <div class="location-info">
                                <h3 class="location-name">Dark Forest</h3>
                                <p class="location-description">Mysterious woods</p>
                            </div>
                            <button class="travel-btn" data-travel-to="dark-forest">
                                <span class="travel-icon">üöÄ</span>
                                Travel
                            </button>
                        </div>

                        <div class="location-item locked" data-location-id="crystal-caves">
                            <div class="location-icon">üîí</div>
                            <div class="location-info">
                                <h3 class="location-name">Crystal Caves</h3>
                                <p class="location-description">Not yet discovered</p>
                            </div>
                            <button class="travel-btn" disabled>
                                <span class="travel-icon">üîí</span>
                                Locked
                            </button>
                        </div>

                        <div class="location-item locked" data-location-id="ancient-temple">
                            <div class="location-icon">üîí</div>
                            <div class="location-info">
                                <h3 class="location-name">Ancient Temple</h3>
                                <p class="location-description">Not yet discovered</p>
                            </div>
                            <button class="travel-btn" disabled>
                                <span class="travel-icon">üîí</span>
                                Locked
                            </button>
                        </div>
                    </div>
                </section>

                <!-- Map Statistics -->
                <section class="map-stats-panel">
                    <h2 class="panel-title">
                        <span class="panel-icon">üìä</span>
                        Exploration
                    </h2>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Explored</div>
                            <div class="stat-value" data-explored-percent>15%</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Locations</div>
                            <div class="stat-value">
                                <span data-locations-discovered>2</span>/<span data-locations-total>12</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Secrets</div>
                            <div class="stat-value">
                                <span data-secrets-found>0</span>/<span data-secrets-total>8</span>
                            </div>
                        </div>
                    </div>
                    <div class="exploration-bar">
                        <div class="exploration-fill" data-exploration-fill style="width: 15%">
                            <div class="exploration-shimmer"></div>
                        </div>
                    </div>
                </section>
            </aside>
        </div>

        <!-- Map Footer -->
        <footer class="map-footer">
            <div class="footer-info">
                <span class="info-icon">üí°</span>
                <span class="info-text">Click on discovered locations to fast travel. Drag to pan, scroll to zoom.</span>
            </div>
            <div class="footer-actions">
                <button class="footer-btn" data-center-map>
                    <span class="btn-icon">üéØ</span>
                    Center on Player
                </button>
                <button class="footer-btn" data-reset-zoom>
                    <span class="btn-icon">üîÑ</span>
                    Reset View
                </button>
            </div>
        </footer>
    </div>

    <!-- POI Details Modal (shown on POI click) -->
    <div class="poi-modal" data-poi-modal>
        <div class="poi-modal-content">
            <button class="poi-modal-close" data-close-poi-modal>‚úï</button>
            <div class="poi-modal-header">
                <span class="poi-modal-icon" data-poi-icon>üè™</span>
                <h3 class="poi-modal-title" data-poi-title>Location Name</h3>
            </div>
            <div class="poi-modal-body">
                <p class="poi-modal-description" data-poi-description>Location description goes here.</p>
                <div class="poi-modal-details">
                    <div class="detail-item">
                        <span class="detail-label">Type:</span>
                        <span class="detail-value" data-poi-type>Shop</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Distance:</span>
                        <span class="detail-value" data-poi-distance>250m</span>
                    </div>
                </div>
            </div>
            <div class="poi-modal-footer">
                <button class="poi-action-btn travel" data-poi-travel>
                    <span class="btn-icon">üöÄ</span>
                    Fast Travel
                </button>
                <button class="poi-action-btn waypoint" data-poi-waypoint>
                    <span class="btn-icon">üìå</span>
                    Set Waypoint
                </button>
            </div>
        </div>
    </div>
</div>
