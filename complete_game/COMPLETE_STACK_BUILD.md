# THE ARCANE CODEX - Complete Full-Stack Build

## What We're Building

A complete web/mobile RPG with:
- ✅ Mobile-responsive UI (works on phones, tablets, desktop)
- ✅ 1-4 player multiplayer support
- ✅ Asymmetric whispers (different info per player)
- ✅ Dynamic scenario generation (via Claude Code)
- ✅ Party trust tracking
- ✅ NPC approval system
- ✅ Divine Council voting
- ✅ Turn-based gameplay

## Architecture Stack

```
Frontend (Mobile/Desktop):
├─ HTML5 (semantic, accessible)
├─ CSS3 (responsive, mobile-first)
├─ Vanilla JavaScript (no dependencies)
└─ WebSocket/Polling for real-time updates

Backend (Python Flask):
├─ Flask 3.0.0 (web framework)
├─ Flask-CORS (cross-origin support)
├─ Flask-SocketIO (real-time communication)
└─ Session management (multiplayer games)

Game Engine:
└─ arcane_codex_server.py (existing, fully functional)

AI GM:
└─ Claude Code (you request, I generate scenarios)
```

## File Structure

```
complete_game/
├─ web_server.py               # Main Flask app (NEW)
├─ arcane_codex_server.py      # Game engine (EXISTS)
│
├─ templates/                  # HTML templates
│   ├─ index.html             # Landing page + game lobby
│   ├─ interrogation.html     # Divine Interrogation
│   ├─ game.html              # Main game interface
│   └─ components/            # Reusable components
│       ├─ whisper.html
│       ├─ council.html
│       └─ npc_panel.html
│
├─ static/                     # Static assets
│   ├─ css/
│   │   ├─ main.css          # Core styles
│   │   ├─ mobile.css        # Mobile overrides
│   │   └─ themes.css        # Color themes
│   │
│   ├─ js/
│   │   ├─ game.js           # Main game logic
│   │   ├─ interrogation.js  # Character creation
│   │   ├─ multiplayer.js    # Session management
│   │   └─ whispers.js       # Whisper system
│   │
│   └─ assets/
│       ├─ icons/            # UI icons
│       └─ sounds/           # (Optional) sound effects
│
└─ scenarios/                  # Generated scenarios storage
    └─ active/                # Current active scenarios
```

## Implementation Plan

### Step 1: Enhanced Flask Backend

I'll create `web_server.py` with these endpoints:

```python
# Game Management
POST /api/create_game          # Create new game session (returns game code)
POST /api/join_game            # Join existing game with code
POST /api/leave_game           # Leave current game
GET  /api/game_state           # Get full game state

# Character Creation
POST /api/start_interrogation  # Begin Divine Interrogation
POST /api/answer_question      # Answer question
GET  /api/interrogation_status # Check progress

# Gameplay
POST /api/start_adventure      # Start game (after all players ready)
GET  /api/get_scene            # Get current public scene
GET  /api/get_whisper          # Get player's private whisper
POST /api/submit_action        # Submit player action
POST /api/request_scenario     # Request new scenario from Claude Code

# NPC & Trust
GET  /api/npcs                 # Get NPC states
POST /api/update_npc_approval  # Update NPC approval
GET  /api/trust                # Get party trust level

# Divine Council
POST /api/trigger_council      # Trigger Divine Council vote
GET  /api/council_result       # Get vote results

# Multiplayer
GET  /api/players              # Get all players in game
POST /api/ready                # Mark player as ready
GET  /api/poll_updates         # Poll for game updates
```

### Step 2: Responsive Frontend

**Mobile-First Design:**
- Base styles for 320px+ (small phones)
- Touch-friendly buttons (44px min)
- Vertical scrolling optimized
- Collapsible panels
- Swipe gestures

**Breakpoints:**
```css
/* Small phones: 320px - 479px */
/* Phones: 480px - 767px */
/* Tablets: 768px - 1023px */
/* Desktop: 1024px+ */
```

### Step 3: Multiplayer Session Management

**How It Works:**

```
Player 1 (Host):
→ Click "Create Game"
→ Get code: ABCD-1234
→ Share with friends

Players 2-4:
→ Enter code ABCD-1234
→ Join game session
→ Complete Divine Interrogation
→ Mark ready

When all ready:
→ Host starts adventure
→ Game begins with all players
```

**Session Storage:**
```python
{
    "game_id": "ABCD-1234",
    "host_id": "player_1",
    "players": [
        {
            "id": "player_1",
            "name": "Alice",
            "class": "Fighter",
            "ready": True
        },
        {
            "id": "player_2",
            "name": "Bob",
            "class": "Mage",
            "ready": True
        }
    ],
    "game_state": {/* arcane_codex_server state */},
    "current_scenario": {/* generated by Claude Code */},
    "whispers": {
        "player_1": "Fighter sees...",
        "player_2": "Mage detects..."
    }
}
```

### Step 4: Asymmetric Whisper Delivery

**Implementation:**

```javascript
// Frontend: whispers.js
async function pollWhisper() {
    const response = await fetch('/api/get_whisper');
    const data = await response.json();

    if (data.whisper) {
        showWhisperNotification(data.whisper);
    }

    // Poll every 5 seconds
    setTimeout(pollWhisper, 5000);
}

// Backend: web_server.py
@app.route('/api/get_whisper')
def get_whisper():
    player_id = session['player_id']
    game_id = session['game_id']

    game_session = games[game_id]
    whisper = game_session['whispers'].get(player_id, None)

    return jsonify({
        'whisper': whisper,
        'has_new': whisper and not whisper['seen']
    })
```

### Step 5: Dynamic Scenario Integration

**Workflow:**

```
1. Game needs new scenario
2. Frontend calls: POST /api/request_scenario
3. Backend formats request for Claude Code
4. YOU (Claude Code) generate unique scenario
5. Backend stores scenario
6. Frontend displays public scene
7. Backend sends asymmetric whispers to each player
```

**Request Format to Claude Code:**

```json
{
    "game_state": {
        "party_trust": 65,
        "players": ["Fighter (HP 85)", "Mage (HP 60)"],
        "npcs": ["Grimsby (Approval 45)", "Renna (Approval 60)"],
        "divine_favor": {"VALDRIS": 35, "KAITHA": 50},
        "location": "Thieves Guild Territory",
        "previous_themes": ["Medicine Heist", "Forest Fire"]
    },
    "requirements": {
        "moral_dilemma": "MUTUALLY_EXCLUSIVE",
        "difficulty": "medium",
        "player_count": 2
    }
}
```

You (Claude Code) respond with complete scenario JSON.

## Quick Start Commands

### Install Dependencies
```bash
cd C:\Users\ilmiv\ProjectArgent\complete_game
pip install flask flask-cors flask-socketio
```

### Run Server
```bash
python web_server.py
```

Server starts on:
- Desktop: http://localhost:5000
- Mobile: http://<your-ip>:5000

### Test Multiplayer
1. Open browser on phone: http://192.168.1.X:5000
2. Open browser on desktop: http://localhost:5000
3. Both join same game code
4. Play together

## Development Phases

### Phase 1: Core Infrastructure (Complete)
- [x] Flask backend skeleton
- [x] Game engine integration
- [x] Basic API endpoints

### Phase 2: Frontend (In Progress)
- [ ] Responsive HTML templates
- [ ] Mobile-first CSS
- [ ] Game JavaScript client
- [ ] Whisper notification system

### Phase 3: Multiplayer (Next)
- [ ] Game code generation
- [ ] Session management
- [ ] Player synchronization
- [ ] Real-time updates

### Phase 4: Dynamic Content (Final)
- [ ] Scenario request system
- [ ] Claude Code integration
- [ ] Content display
- [ ] Testing with generated scenarios

## What You'll Do Next

Tell me one of:
1. **"Build Phase 2 - Frontend"** - I'll create all HTML/CSS/JS files
2. **"Show me the complete web_server.py"** - I'll write the full Flask backend
3. **"Generate a test scenario"** - I'll create a unique scenario to test with

Which would you like me to do first?
